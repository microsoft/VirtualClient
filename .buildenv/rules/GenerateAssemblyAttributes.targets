<?xml version='1.0' encoding='utf-8'?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.5.1" >
    <!-- **********************************************************************
             Support for automatic generation of AssemblyAttributes
    *********************************************************************** -->
    <PropertyGroup>
        <AssemblyAttributesFile>$(IntermediateOutputPath)generated.attributes.$(AssemblyName).cs</AssemblyAttributesFile>
        <AssemblyVersion Condition="'$(AssemblyVersion)' == ''">0.0.0.1</AssemblyVersion>
        <AssemblyCopyright Condition="'$(AssemblyCopyright)'==''">Copyright Microsoft Corporation</AssemblyCopyright>
    </PropertyGroup>

    <Target Name="GenerateAssemblyAttributes" Outputs="$(AssemblyAttributesFile)">

        <Delete Files="$(AssemblyAttributesFile)"/>

        <!-- This has to be a hack, but I'm not sure what dependency I have wrong to ensure this target
             only files after the directory is created -->
        <MakeDir Directories="$(IntermediateOutputPath)" Condition="!Exists('$(IntermediateOutputPath)')" />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Lines="// &lt;autogenerated/&gt;"/>

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Lines="[assembly:System.CLSCompliant($(AssemblyAttributeClsCompliant))]"/>

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyAttributeUseComVisible)' == 'true'"
            Lines="[assembly:System.Runtime.InteropServices.ComVisible($(AssemblyAttributeComVisible))]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyVersion)' != ''"
            Lines="[assembly:System.Reflection.AssemblyVersion(&quot;$(AssemblyVersion)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyAttributeProduct)' != ''"
            Lines="[assembly:System.Reflection.AssemblyProduct(&quot;$(AssemblyAttributeProduct)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyCopyright)' != ''"
            Lines="[assembly:System.Reflection.AssemblyCopyright(&quot;$(AssemblyCopyright)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyAttributeCompany)' != ''"
            Lines="[assembly:System.Reflection.AssemblyCompany(&quot;$(AssemblyAttributeCompany)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyFileVersion)' != ''"
            Lines="[assembly:System.Reflection.AssemblyFileVersion(&quot;$(AssemblyFileVersion)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(NeutralResourcesLanguage)' == 'true'"
            Lines="[assembly:System.Resources.NeutralResourcesLanguage(&quot;$(AssemblyNeutralResourcesLanguage)&quot;, System.Resources.UltimateResourceFallbackLocation.MainAssembly)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyName)' != ''"
            Lines="[assembly:System.Reflection.AssemblyTitle(&quot;$(AssemblyName)&quot;)]"
            />

        <WriteLinesToFile File="$(AssemblyAttributesFile)"
            Condition="'$(AssemblyDescription)' != ''"
            Lines="[assembly:System.Reflection.AssemblyDescription(&quot;$(AssemblyDesciption)&quot;)]"
            />

        <CreateItem Include="$(AssemblyAttributesFile)">
            <Output ItemName="Compile" TaskParameter="Include"/>
            <Output ItemName="Clean"   TaskParameter="Include"/>
        </CreateItem>

    </Target>

    <PropertyGroup>
        <BuildDependsOn>
            GenerateAssemblyAttributes;
            $(BuildDependsOn)
        </BuildDependsOn>
    </PropertyGroup>

    <ItemGroup>
        <Clean Include="$(AssemblyAttributesFile)"/>
    </ItemGroup>

</Project>
