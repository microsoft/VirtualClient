{
    "Description": "FIO I/O Stress Performance Workload",
    "Metadata": {
        "RecommendedMinimumExecutionTime": "00:30:00",
        "SupportedPlatforms": "linux-x64,linux-arm64,win-x64",
        "SupportedOperatingSystems": "CBL-Mariner,CentOS,Debian,RedHat,Suse,Ubuntu,Windows",
        "Notes": "This profile uses FIO job files (e.g. *.jobfile) via the command line.",
        "Documentation": "FIO documentation: https://fio.readthedocs.io/en/latest/fio_doc.html FIO Job File documentation: https://fio.readthedocs.io/en/latest/fio_doc.html#job-file-format"
    },
    "Parameters": {
        "Engine": "{calculate(\"{Platform}\".StartsWith(\"linux\") ? \"libaio\" : \"windowsaio\")}",
        "DiskFillSize": "200G",
        "Duration": "00:03:00",
        "FileSize": "124G",
        "DiskFilter": "BiggestSize"
    },
    "Actions": [
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "DiskFill",
                "MetricScenario": "disk_fill",
                "PackageName": "fio",
                "DiskFilter": "$.Parameters.DiskFilter",
                "CommandLine": "--name=disk_fill --size={DiskFillSize} --numjobs=1 --rw=write --bs=256k --iodepth=64 --ioengine={Engine} --direct=1 --overwrite=1 --thread",
                "Engine": "$.Parameters.Engine",
                "DiskFill": true,
                "DiskFillSize": "$.Parameters.DiskFillSize",
                "ProcessModel": "SingleProcessPerDisk",
                "DeleteTestFilesOnFinish": false
            }
        },
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "FioExecutorJobFile_4K_BlockSize",
                "MetricScenario": "read_write_operations_4k_blocksize",
                "PackageName": "fio",
                "CommandLine": "--bs=4k --runtime={Duration.TotalSeconds} --iodepth=512 --size={FileSize} --ioengine={Engine} {ScriptPath:fio}/oltp-c-operations.fio --output-format=json",
                "Duration": "$.Parameters.Duration",
                "Engine": "$.Parameters.Engine",
                "FileSize": "$.Parameters.FileSize",
                "DiskFilter": "$.Parameters.DiskFilter",
                "ProcessModel": "SingleProcess",
                "DeleteTestFilesOnFinish": false,
                "Tags": "IO,FIO,OLTP"
            }
        },
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "FioExecutorJobFile_8K_BlockSize",
                "MetricScenario": "read_write_operations_8k_blocksize",
                "PackageName": "fio",
                "CommandLine": "--bs=8k --runtime={Duration.TotalSeconds} --iodepth=512 --size={FileSize} --ioengine={Engine} {ScriptPath:fio}/oltp-c-operations.fio --output-format=json",
                "Duration": "$.Parameters.Duration",
                "Engine": "$.Parameters.Engine",
                "FileSize": "$.Parameters.FileSize",
                "DiskFilter": "$.Parameters.DiskFilter",
                "ProcessModel": "SingleProcess",
                "DeleteTestFilesOnFinish": false,
                "Tags": "IO,FIO,OLTP"
            }
        },
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "FioExecutorJobFile_12K_BlockSize",
                "MetricScenario": "read_write_operations_12k_blocksize",
                "PackageName": "fio",
                "CommandLine": "--bs=12k --runtime={Duration.TotalSeconds} --iodepth=512 --size={FileSize} --ioengine={Engine} {ScriptPath:fio}/oltp-c-operations.fio --output-format=json",
                "Duration": "$.Parameters.Duration",
                "Engine": "$.Parameters.Engine",
                "FileSize": "$.Parameters.FileSize",
                "DiskFilter": "$.Parameters.DiskFilter",
                "ProcessModel": "SingleProcess",
                "DeleteTestFilesOnFinish": false,
                "Tags": "IO,FIO,OLTP"
            }
        },
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "FioExecutorJobFile_16K_BlockSize",
                "MetricScenario": "read_write_operations_16k_blocksize",
                "PackageName": "fio",
                "CommandLine": "--bs=16k --runtime={Duration.TotalSeconds} --iodepth=512 --size={FileSize} --ioengine={Engine} {ScriptPath:fio}/oltp-c-operations.fio --output-format=json",
                "Duration": "$.Parameters.Duration",
                "Engine": "$.Parameters.Engine",
                "FileSize": "$.Parameters.FileSize",
                "DiskFilter": "$.Parameters.DiskFilter",
                "ProcessModel": "SingleProcess",
                "DeleteTestFilesOnFinish": false,
                "Tags": "IO,FIO,OLTP"
            }
        },
        {
            "Type": "FioExecutor",
            "Parameters": {
                "Scenario": "FioExecutorJobFile_1024K_BlockSize",
                "MetricScenario": "read_write_operations_1024k_blocksize",
                "PackageName": "fio",
                "CommandLine": "--bs=1024k --runtime={Duration.TotalSeconds} --iodepth=512 --size={FileSize} --ioengine={Engine} {ScriptPath:fio}/oltp-c-operations.fio --output-format=json",
                "Duration": "$.Parameters.Duration",
                "Engine": "$.Parameters.Engine",
                "FileSize": "$.Parameters.FileSize",
                "DiskFilter": "$.Parameters.DiskFilter",
                "ProcessModel": "SingleProcess",
                "DeleteTestFilesOnFinish": false,
                "Tags": "IO,FIO,OLTP"
            }
        }
    ],
    "Dependencies": [
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "fio",
                "Packages-Dnf": "fio,lshw,parted",
                "Packages-Yum": "fio",
                "Packages-Zypper": "fio"
            }
        },
        {
            "Type": "FormatDisks",
            "Parameters": {
                "Scenario": "InitializeDisks"
            }
        },
        {
            "Type": "MountDisks",
            "Parameters": {
                "Scenario": "CreateMountPoints",
                "DiskFilter": "$.Parameters.DiskFilter"
            }
        },
        {
            "Type": "DependencyPackageInstallation",
            "Parameters": {
                "Scenario": "InstallFIOPackage",
                "SupportedPlatforms": "win-x64",
                "BlobContainer": "packages",
                "BlobName": "fio.3.30.0.zip",
                "PackageName": "fio",
                "Extract": true
            }
        }
    ]
}
