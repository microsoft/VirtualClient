{
    "Description": "Sysbench TPCC MySQL Database Server Performance Workload",
    "MinimumExecutionInterval": "00:01:00",
    "Metadata": {
        "RecommendedMinimumExecutionTime": "04:00:00",
        "SupportedPlatforms": "linux-x64,linux-arm64",
        "SupportedOperatingSystems": "Debian,Ubuntu"
    },
    "Parameters": {
        "DatabaseName": "sbtest",
        "DiskFilter": "osdisk:false&sizegreaterthan:256g",
        "Port": "5432",
        "SharedMemoryBuffer": "{calculate({SystemMemoryMegabytes} * 85 / 100)}",
        "DatabaseScenario": "Balanced",
        "Duration": "00:30:00"
    },
    "Actions": [
        {
            "Type": "SysbenchServerExecutor",
            "Parameters": {
                "Scenario": "ExecuteServer",
                "PackageName": "sysbench",
                "Role": "Server"
            }
        },
        {
            "Type": "SysbenchClientExecutor",
            "Parameters": {
                "Scenario": "tpcc",
                "DatabaseSystem": "PostgreSQL",
                "Benchmark": "TPCC",
                "DatabaseName": "$.Parameters.DatabaseName",
                "DatabaseScenario": "$.Parameters.DatabaseScenario",
                "Duration": "$.Parameters.Duration",
                "Workload": "tpcc",
                "PackageName": "sysbench",
                "Role": "Client"
            }
        }
    ],
    "Dependencies": [
        {
            "Type": "FormatDisks",
            "Parameters": {
                "Scenario": "FormatDisks",
                "Role": "Server"
            }
        },
        {
            "Type": "MountDisks",
            "Parameters": {
                "Scenario": "CreateMountPoints",
                "MountLocation": "Root",
                "Role": "Server"
            }
        },
        {
            "Type": "DependencyPackageInstallation",
            "Parameters": {
                "Scenario": "DownloadPostgreSQLServerPackage",
                "BlobContainer": "packages",
                "BlobName": "postgresql.14.0.0.rev1.zip",
                "PackageName": "postgresql",
                "Extract": true,
                "Role": "Server"
            }
        },
        {
            "Type": "DependencyPackageInstallation",
            "Parameters": {
                "Scenario": "DownloadSysbenchPackage",
                "BlobContainer": "packages",
                "BlobName": "sysbench-1.0.20.rev1.zip",
                "PackageName": "sysbench",
                "Extract": true
            }
        },
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages": "python3"
            }
        },
        {
            "Type": "PostgreSQLServerInstallation",
            "Parameters": {
                "Scenario": "InstallPostgreSQLServer",
                "Action": "InstallServer",
                "PackageName": "postgresql",
                "Role": "Server"
            }
        },
        {
            "Type": "PostgreSQLServerConfiguration",
            "Parameters": {
                "Scenario": "ConfigurePostgreSQLServer",
                "Action": "ConfigureServer",
                "PackageName": "postgresql",
                "Role": "Server",
                "DatabaseName": "$.Parameters.DatabaseName",
                "Port": "$.Parameters.Port",
                "SharedMemoryBuffer": "$.Parameters.SharedMemoryBuffer"
            }
        },
        {
            "Type": "PostgreSQLServerConfiguration",
            "Parameters": {
                "Scenario": "ConfigurePostgreSQLServer",
                "Action": "SetupDatabase",
                "PackageName": "postgresql",
                "Role": "Server",
                "DatabaseName": "$.Parameters.DatabaseName",
                "Port": "$.Parameters.Port",
                "SharedMemoryBuffer": "$.Parameters.SharedMemoryBuffer"
            }
        },
        {
            "Type": "SysbenchConfiguration",
            "Parameters": {
                "Scenario": "PopulatePostgreSQLDatabase",
                "DatabaseSystem": "PostgreSQL",
                "Benchmark": "TPCC",
                "DatabaseName": "$.Parameters.DatabaseName",
                "WarehouseCount": 1,
                "DatabaseScenario": "$.Parameters.DatabaseScenario",
                "PackageName": "sysbench",
                "Role": "Server"
            }
        },
        {
            "Type": "PostgreSQLServerConfiguration",
            "Parameters": {
                "Scenario": "DistributePostgreSQLDatabase",
                "Action": "DistributeDatabase",
                "DatabaseName": "$.Parameters.DatabaseName",
                "DiskFilter": "$.Parameters.DiskFilter",
                "PackageName": "postgresql",
                "Port": "$.Parameters.Port",
                "Role": "Server"
            }
        },
        {
            "Type": "SysbenchConfiguration",
            "Parameters": {
                "Scenario": "PopulatePostgreSQLDatabase",
                "DatabaseSystem": "PostgreSQL",
                "Benchmark": "TPCC",
                "DatabaseName": "$.Parameters.DatabaseName",
                "DatabaseScenario": "$.Parameters.DatabaseScenario",
                "PackageName": "sysbench",
                "Role": "Server"
            }
        },
        {
            "Type": "ApiServer",
            "Parameters": {
                "Scenario": "StartAPIServer",
                "Role": "Server"
            }
        }
    ]
}