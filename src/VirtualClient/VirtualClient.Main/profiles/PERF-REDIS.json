{
    "Description": "Redis Benchmark",
    "Metadata": {
        "RecommendedMinimumExecutionTime": "02:00:00",
        "SupportedPlatforms": "linux-x64,linux-arm64",
        "SupportedOperatingSystems": "Ubuntu"
    },
    "Parameters": {
        "ServerPort": 6379,
        "ServerThreadCount": 4,
        "ServerInstances": "{LogicalCoreCount}",
        "ClientInstances": 1,
        "Duration": "00:01:00"
    },
    "Actions": [
        {
            "Type": "RedisServerExecutor",
            "Parameters": {
                "Scenario": "redis_server",
                "PackageName": "redis",
                "CommandLine": "--protected-mode no --io-threads {ServerThreadCount} --maxmemory-policy noeviction --ignore-warnings ARM64-COW-BUG --save",
                "BindToCores": true,
                "Port": "$.Parameters.ServerPort",
                "ServerInstances": "$.Parameters.ServerInstances",
                "ServerThreadCount": "$.Parameters.ServerThreadCount",
                "Role": "Server"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "warmup_32b_pool",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 64 --clients 4 --ratio 1:0 --data-size 32 --pipeline 32 --key-minimum 1 --key-maximum 10000000 --key-prefix sm --key-pattern S:S --run-count 1",
                "ClientInstances": 1,
                "WarmUp": true,
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "warmup_1kb_pool",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 64 --clients 4 --ratio 1:0 --data-size 1024 --pipeline 32 --key-minimum 1 --key-maximum 1000000 --key-prefix med --key-pattern S:S --run-count 1",
                "ClientInstances": 1,
                "WarmUp": true,
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "warmup_10kb_pool",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 64 --clients 4 --ratio 1:0 --data-size 10240 --pipeline 32 --key-minimum 1 --key-maximum 10000 --key-prefix lg --key-pattern S:S --run-count 1",
                "ClientInstances": 1,
                "WarmUp": true,
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_4t_4c_32b_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 4 --clients 4  --ratio 1:1 --data-size 32 --pipeline 100  --key-minimum 1 --key-maximum 10000000 --key-prefix sm --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_8t_32c_32b_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 8 --clients 32  --ratio 1:1 --data-size 32 --pipeline 100  --key-minimum 1 --key-maximum 10000000 --key-prefix sm --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_8t_32c_1kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 8 --clients 32 --ratio 1:1 --data-size 1024 --pipeline 100 --key-minimum 1 --key-maximum 1000000 --key-prefix med --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_8t_32c_10kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 8 --clients 32 --ratio 1:1 --data-size 10240 --pipeline 100 --key-minimum 1 --key-maximum 10000 --key-prefix lg --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_16t_32c_32b_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 16 --clients 32 --ratio 1:1 --data-size 32 --pipeline 100 --key-minimum 1 --key-maximum 10000000 --key-prefix sm --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_16t_32c_1kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 16 --clients 32 --ratio 1:1 --data-size 1024 --pipeline 100 --key-minimum 1 --key-maximum 1000000 --key-prefix med --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_16t_32c_10kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 16 --clients 32 --ratio 1:1 --data-size 10240 --pipeline 100 --key-minimum 1 --key-maximum 10000 --key-prefix lg --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_32t_32c_32b_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 32 --clients 32 --ratio 1:1 --data-size 32 --pipeline 100 --key-minimum 1 --key-maximum 10000000 --key-prefix sm --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_32t_32c_1kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 32 --clients 32 --ratio 1:1 --data-size 1024 --pipeline 100 --key-minimum 1 --key-maximum 1000000 --key-prefix med --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_32t_32c_1kb_r1:10",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 32 --clients 32 --ratio 1:10 --data-size 1024 --pipeline 100 --key-minimum 1 --key-maximum 1000000 --key-prefix med --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "MemtierBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "memtier_32t_32c_10kb_r1:1",
                "PackageName": "memtier",
                "CommandLine": "--protocol redis --threads 32 --clients 32 --ratio 1:1 --data-size 10240 --pipeline 100 --key-minimum 1 --key-maximum 10000 --key-prefix lg --key-pattern R:R --run-count 1 --print-percentiles 50,90,95,99,99.9 --random-data",
                "ClientInstances": "$.Parameters.ClientInstances",
                "Duration": "$.Parameters.Duration",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_8c_32b_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 8 -d 32 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_8c_1kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 8 -d 1024 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_8c_10kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 8 -d 10240 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_16c_32b_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 16 -d 32 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_16c_1kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 16 -d 1024 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_16c_10kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 16 -d 10240 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_32c_32b_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 32 -d 32 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_32c_1kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 32 -d 1024 -n 10000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        },
        {
            "Type": "RedisBenchmarkClientExecutor",
            "Parameters": {
                "Scenario": "redis_32c_10kb_10kreq",
                "PackageName": "redis",
                "CommandLine": "-c 32 -d 10240 -n 1000 -P 4 -q --csv",
                "ClientInstances": "$.Parameters.ClientInstances",
                "MetricFilters": "GET,^SET",
                "Role": "Client"
            }
        }
    ],
    "Dependencies": [
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "build-essential,libevent-dev,pkg-config,zlib1g-dev,libssl-dev,autoconf,automake,libpcre3-dev",
                "Packages-Yum": "zlib-devel,pcre-devel,libevent-devel,openssl-devel,git,gcc-c++,make,autoconf,automake",
                "Packages-Dnf": "zlib-devel,pcre-devel,libevent-devel,openssl-devel,git,gcc-c++,make,autoconf,automake"
            }
        },
        {
            "Type": "LinuxPackageInstallation",
            "Parameters": {
                "Scenario": "InstallLinuxPackages",
                "Packages-Apt": "wget,build-essential,tcl-dev,numactl",
                "Packages-Yum": "wget,numactl,tcl-devel",
                "Packages-Dnf": "wget,numactl,tcl-devel"
            }
        },
        {
            "Type": "WgetPackageInstallation",
            "Parameters": {
                "Scenario": "InstallRedisPackage",
                "PackageName": "redis",
                "PackageUri": "https://github.com/redis/redis/archive/refs/tags/6.2.1.tar.gz",
                "SubPath": "redis-6.2.1",
                "Notes": "Example path to package -> /packages/redis/redis-6.2.1"
            }
        },
        {
            "Type": "ExecuteCommand",
            "Parameters": {
                "Scenario": "CompileRedis",
                "Platforms": "linux-x64,linux-arm64",
                "Command": "make",
                "WorkingDirectory": "{PackagePath:redis}"
            }
        },
        {
            "Type": "CloneRepo",
            "Parameters": {
                "Scenario": "CloneMemtierRepo",
                "RepoUri": "https://github.com/RedisLabs/memtier_benchmark",
                "PackageName": "memtier"
            }
        },
        {
            "Type": "ExecuteCommand",
            "Parameters": {
                "Scenario": "CompileMemtier",
                "Platforms": "linux-x64,linux-arm64",
                "Command": "git checkout 1.4.0&&autoreconf -ivf&&bash -c './configure'&&make",
                "WorkingDirectory": "{PackagePath:memtier}"
            }
        },
        {
            "Type": "ApiServer",
            "Parameters": {
                "Scenario": "StartAPIServer"
            }
        }
    ]
}