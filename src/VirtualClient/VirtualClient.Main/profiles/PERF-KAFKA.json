{
  "Description": "Kafka Benchmark",
  "Metadata": {
    "RecommendedMinimumExecutionTime": "02:00:00",
    "SupportedPlatforms": "linux-x64,win-x64",
    "SupportedOperatingSystems": "Ubuntu, Windows"
  },
  "Parameters": {
    "ServerPort": 9092,
    "ServerInstances": 3,
    "ClientInstances": 1,
    "Duration": "00:02:00"
  },
  "Actions": [
    {
      "Type": "KafkaServerExecutor",
      "Parameters": {
        "Scenario": "kafka_server",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "ServerInstances": "$.Parameters.ServerInstances",
        "Role": "Server"
      }
    },
    {
      "Type": "KafkaClientExecutor",
      "Parameters": {
        "Scenario": "Setup-topic-replication-factor-1-sync",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "WarmUp": true,
        "CommandLine": "--create --topic sync-test-rep-one --partitions 6 --replication-factor 1 --bootstrap-server {0}:{Port}",
        "Role": "Client",
        "CommandType": "Setup"
      }
    },
    {
      "Type": "KafkaClientExecutor",
      "Parameters": {
        "Scenario": "Setup-topic-replication-factor-3-sync",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "WarmUp": true,
        "CommandLine": "--create --topic sync-test-rep-three --partitions 6 --replication-factor 3 --bootstrap-server {0}:{Port}",
        "Role": "Client",
        "CommandType": "Setup"
      }
    },
    {
      "Type": "KafkaClientExecutor",
      "Parameters": {
        "Scenario": "Producer-numOfRec-5000000-recordSize-100-batchSize-8196-sync",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "WarmUp": true,
        "CommandLine": "--topic sync-test-rep-one --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=8196",
        "Role": "Client",
        "CommandType": "ProducerTest"
      }
    },
    {
      "Type": "KafkaClientExecutor",
      "Parameters": {
        "Scenario": "Producer-numOfRec-5000000-recordSize-100-batchSize-64000-sync",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "WarmUp": true,
        "CommandLine": "--topic sync-test-rep-three --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=64000",
        "Role": "Client",
        "CommandType": "ProducerTest"
      }
    },
    {
      "Type": "KafkaClientExecutor",
      "Parameters": {
        "Scenario": "Consumer-messages-5000000-sync",
        "PackageName": "kafka",
        "Port": "$.Parameters.ServerPort",
        "CommandLine": "--topic sync-test-rep-one --messages 5000000 --bootstrap-server {0}:{Port}",
        "Role": "Client",
        "CommandType": "ConsumerTest"
      }
    },
    {
      "Type": "ParallelExecution",
      "Components": [
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Setup-topic-replication-factor-3-async",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "WarmUp": true,
            "CommandLine": "--create --topic async-test-rep-three --partitions 6 --replication-factor 3 --bootstrap-server {0}:{Port}",
            "Role": "Client",
            "CommandType": "Setup"
          }
        },
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Producer-numOfRec-5000000-recordSize-100-batchSize-8196-async",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "WarmUp": true,
            "CommandLine": "--topic async-test-rep-three --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=8196",
            "Role": "Client",
            "CommandType": "ProducerTest"
          }
        }
      ]
    },
    {
      "Type": "ParallelExecution",
      "Components": [
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Producer-numOfRec-5000000-recordSize-100-async-batchSize-8196-1",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "WarmUp": true,
            "CommandLine": "--topic async-test-rep-three --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=8196",
            "Role": "Client",
            "CommandType": "ProducerTest"
          }
        },
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Producer-numOfRec-5000000-recordSize-100-batchSize-8196-async-2",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "WarmUp": true,
            "CommandLine": "--topic async-test-rep-three --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=8196",
            "Role": "Client",
            "CommandType": "ProducerTest"
          }
        },
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Producer-numOfRec-5000000-recordSize-100-batchSize-8196-async-3",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "WarmUp": true,
            "CommandLine": "--topic async-test-rep-three --num-records 5000000 --record-size 100 --throughput -1 --producer-props acks=1 bootstrap.servers={0}:{Port} buffer.memory=67108864 batch.size=8196",
            "Role": "Client",
            "CommandType": "ProducerTest"
          }
        }
      ]
    },
    {
      "Type": "ParallelExecution",
      "Components": [
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Consumer-messages-5000000-async-1",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "CommandLine": "--topic async-test-rep-three --messages 5000000 --bootstrap-server {0}:{Port}",
            "Role": "Client",
            "CommandType": "ConsumerTest"
          }
        },
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Consumer-messages-5000000-async-2",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "CommandLine": "--topic async-test-rep-three --messages 5000000 --bootstrap-server {0}:{Port}",
            "Role": "Client",
            "CommandType": "ConsumerTest"
          }
        },
        {
          "Type": "KafkaClientExecutor",
          "Parameters": {
            "Scenario": "Consumer-messages-5000000-async-3",
            "PackageName": "kafka",
            "Port": "$.Parameters.ServerPort",
            "CommandLine": "--topic async-test-rep-three --messages 5000000 --bootstrap-server {0}:{Port}",
            "Role": "Client",
            "CommandType": "ConsumerTest"
          }
        }
      ]
    }
  ],
  "Dependencies": [
    {
      "Type": "DependencyPackageInstallation",
      "Parameters": {
        "Scenario": "DownloadKafkaPackage",
        "BlobContainer": "packages",
        "BlobName": "kafka_2.13-3.4.0.zip",
        "PackageName": "kafka",
        "Extract": true
      }
    },
    {
      "Type": "DependencyPackageInstallation",
      "Parameters": {
        "Scenario": "InstallJDKPackage",
        "BlobContainer": "packages",
        "BlobName": "microsoft-jdk-17.0.5.zip",
        "PackageName": "javadevelopmentkit",
        "Extract": true
      }
    },
    {
      "Type": "JavaDevelopmentKitInstallation",
      "Parameters": {
        "Scenario": "InstallJDK",
        "PackageName": "javadevelopmentkit"
      }
    },
    {
      "Type": "ApiServer",
      "Parameters": {
        "Scenario": "StartAPIServer"
      }
    }
  ]
}