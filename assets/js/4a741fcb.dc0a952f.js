"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[7773],{7907:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var t=i(4848),r=i(8453);const s={},a="Azure Key Vault Integration",l={id:"guides/0620-integration-key-vault",title:"Azure Key Vault Integration",description:"Azure Key Vault is a secure cloud service for storing and accessing secrets, keys, and certificates. Virtual Client supports integration with Azure Key Vault, allowing you to retrieve secrets and certificates for use in your workloads, monitors, automation, and telemetry scenarios.",source:"@site/docs/guides/0620-integration-key-vault.md",sourceDirName:"guides",slug:"/guides/0620-integration-key-vault",permalink:"/VirtualClient/docs/guides/0620-integration-key-vault",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/guides/0620-integration-key-vault.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Azure Event Hub Integration",permalink:"/VirtualClient/docs/guides/0610-integration-event-hub"},next:{title:"Workloads",permalink:"/VirtualClient/docs/category/workloads"}},c={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"Authentication Preliminaries",id:"authentication-preliminaries",level:2},{value:"Installing Certificates on Linux",id:"installing-certificates-on-linux",level:3},{value:"Installing Certificates on Windows",id:"installing-certificates-on-windows",level:3},{value:"Key Vault Integration",id:"key-vault-integration",level:2},{value:"Supported Reference Styles",id:"supported-reference-styles",level:3},{value:"URI-Style References",id:"uri-style-references",level:4},{value:"Connection String-Style References",id:"connection-string-style-references",level:4},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Retrieve a Secret Using Managed Identity",id:"retrieve-a-secret-using-managed-identity",level:3},{value:"Retrieve a Secret Using Microsoft Entra ID and Certificate Thumbprint",id:"retrieve-a-secret-using-microsoft-entra-id-and-certificate-thumbprint",level:3},{value:"Retrieve a Secret Using Microsoft Entra ID and Certificate Issuer/Subject",id:"retrieve-a-secret-using-microsoft-entra-id-and-certificate-issuersubject",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"azure-key-vault-integration",children:"Azure Key Vault Integration"}),"\n",(0,t.jsx)(n.p,{children:"Azure Key Vault is a secure cloud service for storing and accessing secrets, keys, and certificates. Virtual Client supports integration with Azure Key Vault, allowing you to retrieve secrets and certificates for use in your workloads, monitors, automation, and telemetry scenarios."}),"\n",(0,t.jsx)(n.p,{children:"This guide covers the requirements, supported authentication methods, command-line options, and usage examples for integrating Azure Key Vault with Virtual Client."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#authentication-preliminaries",children:"Authentication Preliminaries"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#installing-certificates-on-linux",children:"Certificates on Linux"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#installing-certificates-on-windows",children:"Certificates on Windows"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#key-vault-integration",children:"Key Vault Integration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#supported-reference-styles",children:"Supported Reference Styles"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#uri-style-references",children:"URI-Style References"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#connection-string-style-references",children:"Connection String-Style References"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#usage-examples",children:"Usage Examples"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#error-handling",children:"Error Handling"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#best-practices",children:"Best Practices"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#references",children:"References"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Virtual Client can retrieve secrets and certificates from Azure Key Vault for use in authentication, secure configuration, and workload execution. You can specify a Key Vault endpoint or connection string using command-line options. Virtual Client supports both Microsoft Entra ID (formerly Azure AD) and Managed Identity authentication."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"authentication-preliminaries",children:"Authentication Preliminaries"}),"\n",(0,t.jsx)(n.h3,{id:"installing-certificates-on-linux",children:"Installing Certificates on Linux"}),"\n",(0,t.jsx)(n.p,{children:"Virtual Client is a .NET application. Certificates used on a Linux system must be X.509 certificates containing a private key (e.g., PKCS#12, *.pfx). Certificates must be installed in the expected location for the user running Virtual Client:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Root:"})," ",(0,t.jsx)(n.code,{children:"/root/.dotnet/corefx/cryptography/x509stores/my/"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Specific User:"})," ",(0,t.jsx)(n.code,{children:"/home/{user}/.dotnet/corefx/cryptography/x509stores/my/"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Ensure the user has read/write access to this directory and the certificate files. Set permissions as follows:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"sudo chmod -R 700 /home/{user}/.dotnet/corefx/cryptography/x509stores/my/"})}),"\n",(0,t.jsx)(n.h3,{id:"installing-certificates-on-windows",children:"Installing Certificates on Windows"}),"\n",(0,t.jsx)(n.p,{children:"Virtual Client will look for certificates in these stores:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CurrentUser/Personal:"})," The personal certificate store for the current user."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"LocalMachine/Personal:"})," The local machine certificate store."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It is recommended to install certificates into the user-specific store."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"key-vault-integration",children:"Key Vault Integration"}),"\n",(0,t.jsx)(n.p,{children:"Virtual Client supports referencing Azure Key Vault using both URI-style and connection string-style formats. The Key Vault can be used to retrieve secrets (e.g., API keys, passwords) and certificates for use in your workloads."}),"\n",(0,t.jsx)(n.h3,{id:"supported-reference-styles",children:"Supported Reference Styles"}),"\n",(0,t.jsx)(n.h4,{id:"uri-style-references",children:"URI-Style References"}),"\n",(0,t.jsx)(n.p,{children:"You can specify the Key Vault endpoint as a URI, optionally with authentication parameters:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Microsoft Entra ID/App with Certificate (by thumbprint):"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="https://myvault.vault.azure.net?cid={clientId}&tid={tenantId}&crtt={certificateThumbprint}"\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Microsoft Entra ID/App with Certificate (by issuer and subject):"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="https://myvault.vault.azure.net?cid={clientId}&tid={tenantId}&crti={issuer}&crts={subject}"\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Managed Identity:"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="https://myvault.vault.azure.net?miid={managedIdentityClientId}"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"connection-string-style-references",children:"Connection String-Style References"}),"\n",(0,t.jsx)(n.p,{children:"You can also use a connection string format:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Microsoft Entra ID/App with Certificate (by thumbprint):"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="EndpointUrl=https://myvault.vault.azure.net;ClientId={clientId};TenantId={tenantId};CertificateThumbprint={certificateThumbprint}"\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Microsoft Entra ID/App with Certificate (by issuer and subject):"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="EndpointUrl=https://myvault.vault.azure.net;ClientId={clientId};TenantId={tenantId};CertificateIssuer={issuer};CertificateSubject={subject}"\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Managed Identity:"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'--key-vault="EndpointUrl=https://myvault.vault.azure.net;ManagedIdentityId={managedIdentityClientId}"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(n.h3,{id:"retrieve-a-secret-using-managed-identity",children:"Retrieve a Secret Using Managed Identity"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'VirtualClient --key-vault="https://myvault.vault.azure.net?miid=6d3c5db8-e14b-44b7-9887-d168b5f659f6"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"retrieve-a-secret-using-microsoft-entra-id-and-certificate-thumbprint",children:"Retrieve a Secret Using Microsoft Entra ID and Certificate Thumbprint"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'VirtualClient --key-vault="EndpointUrl=https://myvault.vault.azure.net;ClientId=08331e3b-1458-4de2-b1d6-7007bc7221d5;TenantId=573b5dBbe-c477-4a10-8986-a7fe10e2d79B;CertificateThumbprint=f5b114e61c6a81b40c1e7a5e4d11ac47da6e445f"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"retrieve-a-secret-using-microsoft-entra-id-and-certificate-issuersubject",children:"Retrieve a Secret Using Microsoft Entra ID and Certificate Issuer/Subject"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'VirtualClient --key-vault="EndpointUrl=https://myvault.vault.azure.net;ClientId=08331e3b-1458-4de2-b1d6-7007bc7221d5;TenantId=573b5dBbe-c477-4a10-8986-a7fe10e2d79B;CertificateIssuer=CN=ABC CA 01, DC=ABC, DC=COM;CertificateSubject=CN=any.domain.com"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Virtual Client will report errors if:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The Key Vault endpoint or credentials are invalid."}),"\n",(0,t.jsx)(n.li,{children:"The specified secret or certificate is not found."}),"\n",(0,t.jsx)(n.li,{children:"Permissions are insufficient (e.g., forbidden)."}),"\n",(0,t.jsx)(n.li,{children:"The certificate is missing or inaccessible."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Refer to the logs for detailed error messages. See unit tests in ",(0,t.jsx)(n.code,{children:"KeyVaultManagerTests.cs"})," for expected error handling scenarios."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use Managed Identity where possible for secure, passwordless authentication."}),"\n",(0,t.jsx)(n.li,{children:"Store certificates securely and restrict access to certificate files."}),"\n",(0,t.jsx)(n.li,{children:"Grant only necessary permissions to the Key Vault and its secrets/certificates."}),"\n",(0,t.jsx)(n.li,{children:"Test your Key Vault integration using the provided unit tests and error scenarios."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/key-vault/",children:"Azure Key Vault Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://microsoft.github.io/VirtualClient/docs/guides/0010-command-line/",children:"Virtual Client Command-Line Reference"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);