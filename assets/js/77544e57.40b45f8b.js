"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[9695],{7315:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var i=t(4848),o=t(8453);const r={},a="Error Handling Recommendations",s={id:"developing/0070-error-handling",title:"Error Handling Recommendations",description:"The following sections describe important details and recommendations for handling errors/exceptions in the operations of the",source:"@site/docs/developing/0070-error-handling.md",sourceDirName:"developing",slug:"/developing/0070-error-handling",permalink:"/VirtualClient/docs/developing/0070-error-handling",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/developing/0070-error-handling.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Building Docker Containers",permalink:"/VirtualClient/docs/developing/0061-build-docker-container"},next:{title:"Coding Standards",permalink:"/VirtualClient/docs/developing/0080-coding-standards"}},l={},c=[{value:"VirtualClientException",id:"virtualclientexception",level:2},{value:"Exception Handling",id:"exception-handling",level:2},{value:"Exception Handling Recommendations",id:"exception-handling-recommendations",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"error-handling-recommendations",children:"Error Handling Recommendations"}),"\n",(0,i.jsx)(n.p,{children:"The following sections describe important details and recommendations for handling errors/exceptions in the operations of the\nVirtual Client runtime. Error handling is particularly important for the quality of a runtime platform where there are many moving\nparts."}),"\n",(0,i.jsx)(n.h2,{id:"virtualclientexception",children:"VirtualClientException"}),"\n",(0,i.jsxs)(n.p,{children:["The Virtual Client platform/core contains a base class that is used for most exceptions that are explicitly raised/thrown in the application\nnamed ",(0,i.jsx)(n.strong,{children:"VirtualClientException"}),". This exception class derives from the .NET framework 'Exception' class and allows the developer to communicate\nnot only a description of the error but also a structured \"reason\" for the error. The profile execution logic makes determinations on the severity\nof exceptions that are raised/thrown based on the data type of the exception as well as the error reason that is supplied."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Contracts/Exceptions.cs",children:"Custom Platform/Core Exceptions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Contracts/Enumerations.cs",children:"Error Reasons"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Core/ProfileExecutor.cs",children:"Profile Execution Logic"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"// Custom exception classes in the Virtual Client platform/core derive from the base VirtualClientException class. Each of the\n// platform/core exception classes implement the same constructors for consisteny. The 'ErrorReason' provided is an important distinction.\npublic class WorkloadException : VirtualClientException\n{\n    public WorkloadException()\n        : base()\n    {\n    }\n\n    public WorkloadException(string message)\n        : base(message)\n    {\n    }\n\n    public WorkloadException(string message, ErrorReason reason)\n        : base(message, reason)\n    {\n    }\n\n    public WorkloadException(string message, Exception innerException)\n        : base(message, innerException)\n    {\n    }\n\n    public WorkloadException(string message, Exception innerException, ErrorReason reason)\n        : base(message, innerException, reason)\n    {\n    }\n}\n\n// Errors raised during the operations of the hosted REST API service.\nthrow new ApiException();\n\n// Errors raised during the operations of a dependency installer/handler.\nthrow new DependencyException();\n\n// Errors raised during the operations of a monitor.\nthrow new MonitorException();\n\n// Errors raised during the operations of a workload/test.\nthrow new WorkloadException();\n\n// Errors raised during the operations of parsing the results of a workload/test.\nthrow new WorkloadResultsException();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,i.jsx)(n.p,{children:"Based upon the data type of the exception thrown as well as the 'ErrorReason' (if it is one of the custom platform/core exceptions), the profile execution\nlogic makes a decision on whether to handle it or let the Virtual Client crash. Thus error handling in the Virtual Client is a fair amount methodical and there\nare recommendations as to how exceptions should be handled and thrown/raised. The type and severity of exceptions that are raised are at the discretion of the\ndeveloper that implements them. The specifics of the nature of errors can only be known in the context of the component a developer implements. The developer\ncan communicate error handling intent to the profile execution that is relevant. There are recommendations in sections that follow."}),"\n",(0,i.jsx)(n.p,{children:"The following sections explain some of the methodology around exception handling in the Virtual Client."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Exceptions that are not explicitly handled by the profile execution logic result in a crash"}),(0,i.jsx)(n.br,{}),"\n","The profile execution logic handles a few different exception types. However, if an exception is not a part of that explicit list of exceptions, the Virtual Client\nruntime application will crash."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"VirtualClientException instances with error reasons from 100 - 399 are considered transient"}),(0,i.jsx)(n.br,{}),"\n","Exceptions with an ErrorReason value from 100 - 399 are considered transient and will be handled. Transient errors are those in which the\ndeveloper has indicated the error will very likely go away within a period of time and thus the runtime operations will begin succeeding as expected. Exceptions\nof this type will not crash the Virtual Client. The profile execution logic will continue onward. For example, if a particular workload execution action in a\nprofile happened to fail, the profile execution logic would continue on to the next action."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"VirtualClientException instances with error reasons from 400 - 499 represent critical failures that cannot be confirmed as transient or not"}),(0,i.jsx)(n.br,{}),"\n","Exceptions with an ErrorReason value from 400 - 499 represent highly disruptive failures to the operations of the Virtual Client. However, they may or may not be\ntransient. That determination is not clear. It is this distinction (the fact that we cannot know if it is transient) why the profile execution logic generally handles\nexceptions of this type and continue onward."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"VirtualClientException instances with error reasons >= 500 represent terminal/permanent failures"}),(0,i.jsx)(n.br,{}),"\n","Exceptions with an ErrorReason value greater than or equal to 500 represent terminal failures. These are failures where it is generally know that the Virtual Client\ncould never recover from them. For example the user supplied the name of a profile on the command line that does not exist. In this case, the profile file does not exist\nand thus the Virtual Client could never know what it was supposed to do. Exceptions of this type will crash the Virtual Client."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"exception-handling-recommendations",children:"Exception Handling Recommendations"}),"\n",(0,i.jsx)(n.p,{children:"The following sections document recommendations for the developer to follow when implementing new components in the Virtual Client codebase."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explicitly handle known exceptions"}),(0,i.jsx)(n.br,{}),"\n","As a general rule, all known exceptions should be handled and dealt with appropriately. The developer should make a decision depending upon the type of exception\nwhether it should then be propagated further. Exceptions that are not handled in an individual component will almost always crash the Virtual Client application.\nThis is by design."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Retry on transient errors"}),(0,i.jsx)(n.br,{}),"\n","For many cases of transient errors, a simple set of retries is enough to recover. Retries on transient error situations can be one of the best ways to build\nreliability into an application. The Virtual Client codebase leverages an open source .NET framework called 'Polly' to implement retry handling logic in\na consistent manner. The framework is already a part of the Virtual Client platform/core projects and libraries."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://www.thepollyproject.org/",children:"Polly Transient Fault Handling Library"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Always provide good context-specific information in exceptions raised/thrown"}),(0,i.jsx)(n.br,{}),"\n","Regardless of the quality of a software application, errors will always occur given time and certain scenarios. Error handling is always a challenging thing to\ndo well in any application; however, one of the key most important things to ensure is that the information provided in an error/exception is clear. Few things\nare worse than having to figure out why an application is failing and having very little information by which to do so. When developing components in the Virtual\nClient codebase, take the time to provide good information in error messages. Provide any amount of context information that is available in the code at the point\nof throwing the exception that would help another person (including users and folks that do not program) understand what has happened. Sometimes a quality error enables\na user to course-correct. Otherwise, the user will likely be reaching out to the team and making it the someone on your team's problem instead. Lots of time is\nwasted in this way."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'try\n{\n    ...\n}\ncatch (FileNotFoundException exc)\n{\n    // This is an example of an error which is not very good. What file was not found?!! There will likely be more\n    // than 1 file involved in running a particular Virtual Client profile. Give the user some pertinent information\n    // about the situation so that they might be able to do something intelligent about it.\n    throw new WorkloadException("The file was not found.", exc);\n\n    // This is an example of better error information. The user might be able to address this on his/her own without need\n    // for extra assistance. That is more satisfying for the user (who can self-help) as well as for the team.\n    throw new WorkloadException(\n        $"The expected script file \'{scriptFile}\' was not found in the workload package with the name \'{this.PackageName}\'. " +\n        $"This script is used to parse the custom results from the workload.",\n        exc);\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Define an appropriate 'ErrorReason' when raising/throwing exceptions that indicate transient errors"}),(0,i.jsx)(n.br,{}),"\n","If an exception is caught within a given component that is deemed to be transient (despite any retries attempted), the exception thrown should be one of the\ntypes that derive from the 'VirtualClientException' class. Additionally an appropriate 'ErrorReason' should be supplied indicating the category and severity of\nthe error so that the profile execution logic can itself handle it appropriately. Transient error reasons are in the range of 100 - 399. If an appropriate reason\ndoes not already exist on the 'ErrorReason' enumeration, create one."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"try\n{\n    ...\n}\ncatch (FileNotFoundException exc)\n{\n    // ErrorReason.WorkloadResultsNotFound = 314\n\n    throw new WorkloadException(\n      $\"The '{workloadName}' workload experienced an issue writing the results file to the system.\",\n      exc,\n      ErrorReason.WorkloadResultsNotFound);\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Define an appropriate 'ErrorReason' when raising/throwing exceptions that indicate terminal/permanent errors"}),(0,i.jsx)(n.br,{}),"\n","If an exception is caught within a given component that is deemed to be transient (despite any retries attempted), the exception thrown should be one of the\ntypes that derive from the 'VirtualClientException' class. Additionally an appropriate 'ErrorReason' should be supplied indicating the category and severity of\nthe error so that the profile execution logic can itself handle it appropriately. Transient error reasons are in the range of 100 - 399. If an appropriate reason\ndoes not already exist on the 'ErrorReason' enumeration, create one."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"try\n{\n    ...\n}\ncatch (FileNotFoundException exc)\n{\n    // ErrorReason.ProfileNotFound = 500\n\n    throw new DependencyException(\n      $\"A profile '{profileName}' does not exist on the file system by this name or path provided.\",\n      exc,\n      ErrorReason.ProfileNotFound);\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Always include the original exception when raising/throwing another/custom type of exception"}),(0,i.jsx)(n.br,{}),"\n","If an exception is caught within a given component and the developer chooses to propagate it by throwing an exception of a different\ntype, the original exception should be included in the new exception instance."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"try\n{\n    // Some logic here that is looking for a specific file on the file system.\n    string script = this.systemManagement.FileSystem.File.ReadAllText(filePath);\n}\ncatch (FileNotFoundException exc)\n{\n    throw new WorkloadException(\n        $\"The expected workload script '{filePath}' does not exist on the file system.\",\n        exc,\n        ErrorReason.DependencyNotFound);\n}\n"})}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var i=t(6540);const o={},r=i.createContext(o);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);