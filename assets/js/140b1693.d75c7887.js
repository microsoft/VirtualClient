"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[5171],{8075:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>a,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var t=s(4848),r=s(8453);const i={},o="OpenSSL-TLS",l={id:"workloads/openssl/openssl-tls",title:"OpenSSL-TLS",description:"This version workload sets up OpenSSL client and server processes and measures the file throughput at the client side.",source:"@site/docs/workloads/openssl/openssl-tls.md",sourceDirName:"workloads/openssl",slug:"/workloads/openssl/openssl-tls",permalink:"/VirtualClient/docs/workloads/openssl/openssl-tls",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/workloads/openssl/openssl-tls.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OpenSSL Workload Profiles",permalink:"/VirtualClient/docs/workloads/openssl/openssl-profiles"},next:{title:"Prime95",permalink:"/VirtualClient/docs/workloads/prime95/"}},c={},d=[{value:"What is Being Measured?",id:"what-is-being-measured",level:2},{value:"Workload Metrics",id:"workload-metrics",level:3},{value:"TotalBytesRead - for a given duration total bytes transferred from server to client",id:"totalbytesread---for-a-given-duration-total-bytes-transferred-from-server-to-client",level:4},{value:"NumberOfConnections\t - number of connections made for a given duration",id:"numberofconnections---number-of-connections-made-for-a-given-duration",level:4},{value:"Duration\t       - seconds for which client transacts with the server through s_time tool _",id:"duration---------seconds-for-which-client-transacts-with-the-server-through-s_time-tool-_",level:4},{value:"BytesReadPerConnection - TotalBytesRead/NumberOfConnections",id:"bytesreadperconnection---totalbytesreadnumberofconnections",level:4},{value:"NewConnectionThroughput - TotalBytesRead/Duration",id:"newconnectionthroughput---totalbytesreadduration",level:4},{value:"NewConnectionsPerSec\t- NumberOfConnections/Duration",id:"newconnectionspersec--numberofconnectionsduration",level:4},{value:"1. server side cert/key generation",id:"1-server-side-certkey-generation",level:2},{value:"2.  html file generation",id:"2--html-file-generation",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"openssl-tls",children:"OpenSSL-TLS"}),"\n",(0,t.jsxs)(n.p,{children:["This version workload sets up OpenSSL client and server processes and measures the file throughput at the client side.\nOpenSSL offers a pair of benchmarking tools to measure the network performance of TLS connections: ",(0,t.jsx)(n.code,{children:"openssl s_server_"})," and ",(0,t.jsx)(n.code,{children:"openssl s_time"}),"."]}),"\n",(0,t.jsx)(n.h1,{id:"setting-up-the-server",children:"Setting up the server"}),"\n",(0,t.jsxs)(n.p,{children:["To set up the server, you can use the ",(0,t.jsx)(n.code,{children:"openssl s_server"})," command. This command starts a simple TLS server that listens for incoming connections. You will need to provide a certificate and a private key for the server to use."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openssl s_server -accept 4433 -cert server.crt -key server.key -WWW \n"})}),"\n",(0,t.jsx)(n.p,{children:"WWW option sets up a mock webserver to respond to HTTP requests, which is useful for testing purposes."}),"\n",(0,t.jsx)(n.h1,{id:"setting-up-the-client",children:"Setting up the client"}),"\n",(0,t.jsxs)(n.p,{children:["To set up the client, you can use the ",(0,t.jsx)(n.code,{children:"openssl s_time"})," command. This command connects to the TLS server and can be used to send requests and receive responses.\nIn a TLS scenario, client side certificates can also be validated if server uses verify option. Since this is a simple benchmark, we will not use client certificates."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openssl s_time -connect localhost:4433 -new -time 10\n"})}),"\n",(0,t.jsx)(n.p,{children:"this simple command will connect to the server and send requests for 10 seconds, measuring number of new connections (in 10 seconds) and number of reuse connections (in 10 seconds). This however does not report throughput.\nTo measure throughput, we can request a specific html file from the server and that reports number of bytes for every transaction and total throughput."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"s_time -connect {ServerIp}:{ServerPort} -www /test_1k.html -time {Duration.TotalSeconds} -ciphersuites TLS_AES_128_GCM_SHA256 -tls1_3\n"})}),"\n",(0,t.jsx)(n.p,{children:"This command requests a html file of size 1K and uses AES_128_GCM_SHA256 algorithm for its secure transaction."}),"\n",(0,t.jsx)(n.h1,{id:"chosen-algorithms",children:"Chosen algorithms"}),"\n",(0,t.jsx)(n.p,{children:"s_server/s_time can be used with SSL/TLS different versions, we decided to restrict to Tls1_3 as this is the most widely used cyphersuite currently."}),"\n",(0,t.jsxs)(n.p,{children:["Difference between Tls1_2 and Tls1_3 is documented ",(0,t.jsx)(n.a,{href:"/VirtualClient/docs/workloads/openssl/Tls12vsTls13",children:"here"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The following Tls1_3 cryptographic cypher suites are measured."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"TLS_AES_128_GCM_SHA256"}),"\n",(0,t.jsx)(n.li,{children:"TLS_AES_256_GCM_SHA384"}),"\n",(0,t.jsx)(n.li,{children:"TLS_CHACHA20_POLY1305_SHA256"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"what-is-being-measured",children:"What is Being Measured?"}),"\n",(0,t.jsx)(n.p,{children:"OpenSSL client requests specific file size varying 1KiB - 512 MiB and reports the throughput."}),"\n",(0,t.jsx)(n.h3,{id:"workload-metrics",children:"Workload Metrics"}),"\n",(0,t.jsx)(n.p,{children:"The following section explains the metrics of this workload. These metrics are measured on the client side from s_time."}),"\n",(0,t.jsx)(n.p,{children:"There are 6 metrics."}),"\n",(0,t.jsx)(n.h4,{id:"totalbytesread---for-a-given-duration-total-bytes-transferred-from-server-to-client",children:"TotalBytesRead - for a given duration total bytes transferred from server to client"}),"\n",(0,t.jsx)(n.h4,{id:"numberofconnections---number-of-connections-made-for-a-given-duration",children:"NumberOfConnections\t - number of connections made for a given duration"}),"\n",(0,t.jsx)(n.h4,{id:"duration---------seconds-for-which-client-transacts-with-the-server-through-s_time-tool-_",children:"Duration\t       - seconds for which client transacts with the server through s_time tool _"}),"\n",(0,t.jsx)(n.h4,{id:"bytesreadperconnection---totalbytesreadnumberofconnections",children:"BytesReadPerConnection - TotalBytesRead/NumberOfConnections"}),"\n",(0,t.jsx)(n.h4,{id:"newconnectionthroughput---totalbytesreadduration",children:"NewConnectionThroughput - TotalBytesRead/Duration"}),"\n",(0,t.jsx)(n.h4,{id:"newconnectionspersec--numberofconnectionsduration",children:"NewConnectionsPerSec\t- NumberOfConnections/Duration"}),"\n",(0,t.jsx)(n.p,{children:"These metrics are reported for every file size that is requested in the profile and for three of the Tls1_3 cybersuites. TLS_AES_128_GCM_SHA256, TLS_AES_256_GCM_SHA384, TLS_CHACHA20_POLY1305_SHA256"}),"\n",(0,t.jsx)(n.p,{children:"Two sets of these metrics are reported, new connection and reuse connection."}),"\n",(0,t.jsx)(n.p,{children:"What is the difference between new and reuse connection."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"New connection\nEvery ServerHello - keyExchange happens."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Reuse connection\nFirst ServerHello, keyExchange happens and this is saved on the client end and then on ClientHello sends these learned keys and server acknowledges them.\nAs a result the number of connections and throughput can be noticed slightly higher in reuse scenario."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"ScenarioName"}),(0,t.jsx)(n.th,{children:"MetricName"}),(0,t.jsx)(n.th,{children:"MetricUnit"}),(0,t.jsx)(n.th,{children:"max_MetricValue"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"TotalBytesRead"}),(0,t.jsx)(n.td,{children:"bytes"}),(0,t.jsx)(n.td,{children:"14193720"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"NumberOfConnections"}),(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"13290"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"Duration"}),(0,t.jsx)(n.td,{children:"seconds"}),(0,t.jsx)(n.td,{children:"31"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"BytesReadPerConnection"}),(0,t.jsx)(n.td,{children:"bytes/connection"}),(0,t.jsx)(n.td,{children:"1068"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"NewConnectionThroughput"}),(0,t.jsx)(n.td,{children:"bytes/sec"}),(0,t.jsx)(n.td,{children:"457861.935483871"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"NewConnectionsPerSec"}),(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"428.709677419355"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseTotalBytesRead"}),(0,t.jsx)(n.td,{children:"bytes"}),(0,t.jsx)(n.td,{children:"24037476"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseNumberOfConnections"}),(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"22507"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseDuration"}),(0,t.jsx)(n.td,{children:"seconds"}),(0,t.jsx)(n.td,{children:"31"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseBytesReadPerConnection"}),(0,t.jsx)(n.td,{children:"bytes/connection"}),(0,t.jsx)(n.td,{children:"1068"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseConnectionThroughput"}),(0,t.jsx)(n.td,{children:"bytes/sec"}),(0,t.jsx)(n.td,{children:"775402.451612903"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"tls_client_chacha20-poly1305-sha256-1k"}),(0,t.jsx)(n.td,{children:"ReuseConnectionsPerSec"}),(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"726.032258064516"})]})]})]}),"\n",(0,t.jsx)(n.h1,{id:"additional-utilities",children:"Additional utilities"}),"\n",(0,t.jsx)(n.h2,{id:"1-server-side-certkey-generation",children:"1. server side cert/key generation"}),"\n",(0,t.jsx)(n.p,{children:"keys and certs are generated through this command."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openssl req -x509 -newkey rsa:2048 -keyout server.key -out server.crt -days 3650 -nodes\n"})}),"\n",(0,t.jsx)(n.p,{children:"[please note this cert is set to expire after 10 years i.e., 3650 days]"}),"\n",(0,t.jsx)(n.h2,{id:"2--html-file-generation",children:"2.  html file generation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Usage: ./generate_html.sh filename size_in_kb\n# Example: ./generate_html.sh test.html 1024\n\nFILENAME=$1\nSIZE_KB=$2\nSIZE_BYTES=$((SIZE_KB * 1024))\n\nHEADER="<html>\n<head><title>Test File</title></head>\n<body>\n"\nFOOTER="</body>\n</html>"\n\n# Calculate current size of header + footer\nHEADER_SIZE=$(echo -n "$HEADER$FOOTER" | wc -c)\nPADDING_SIZE=$((SIZE_BYTES - HEADER_SIZE))\n\nif [ $PADDING_SIZE -le 0 ]; then\n\xa0 echo "Requested size too small. Minimum size is $HEADER_SIZE bytes."\n\xa0 exit 1\nfi\n\n# Generate padding\nPADDING="\x3c!-- $(head -c $((PADDING_SIZE - 12)) < /dev/zero | tr \'\\0\' \'A\') --\x3e"\n\n# Write to file\n{\necho "$HEADER"\necho "$PADDING"\necho "$FOOTER"\n} > "$FILENAME"\n\necho "Generated $FILENAME with size approximately ${SIZE_KB}KB."\n'})}),"\n",(0,t.jsx)(n.p,{children:"For eg., to generate a html file size of 100KiB run the script as follows"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"./generate_html.sh test_100KiB.html 100\n"})}),"\n",(0,t.jsx)(n.p,{children:"These files (1 and 2) i.e., server key/certs and required html files are packaged in to a zip file and installed on the server machine while setting up the workload. It is important to note that the html files should be present in the same path where openssl binary runs (this is handled inside the VC code). If a file that is not present is passed in the command line, a standard index.html is returned by s_server and this may disrupt our throughput measurement."}),"\n",(0,t.jsx)(n.h1,{id:"reference",children:"Reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/openssl/openssl",children:"OpenSSL GitHub"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.openssl.org/",children:"OpenSSL Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openssl.org/3.3/man1/openssl-s_server/",children:"OpenSSL s_server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openssl.org/3.3/man1/openssl-s_time/",children:"OpenSSL s_time"})}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"technical-debt",children:"Technical Debt:"}),"\n",(0,t.jsx)(n.p,{children:"Evaluate what is the ideal buffer size to measure, currently the profile has sizes from 1KiB - 512MiB\nEvaluate ideal duration to use, currently 30 seconds is used.\nAdd more unit test coverage for Openssl-tls, Openssl-client, TlsOpenssl-metric parser."})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);