"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[9563],{5204:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=t(5893),i=t(3905);const a={},o="Profiles",s={id:"guides/0011-profiles",title:"Profiles",description:'The Virtual Client defines the work/operations that will happen on a system in structured JSON documents called "profiles". Profiles can be thought',source:"@site/docs/guides/0011-profiles.md",sourceDirName:"guides",slug:"/guides/0011-profiles",permalink:"/VirtualClient/docs/guides/0011-profiles",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/guides/0011-profiles.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Command Line Options",permalink:"/VirtualClient/docs/guides/0010-command-line"},next:{title:"Client/Server Support",permalink:"/VirtualClient/docs/guides/0020-client-server"}},l={},c=[{value:"Metadata",id:"metadata",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Well-Known Parameters",id:"well-known-parameters",level:2},{value:"Inline Parameter References",id:"inline-parameter-references",level:2},{value:"Inline Parameter References -&gt; Time Spans",id:"inline-parameter-references---time-spans",level:2},{value:"Inline Parameter References -&gt; Calculations",id:"inline-parameter-references---calculations",level:2},{value:"Actions",id:"actions",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Monitors",id:"monitors",level:2},{value:"Using Multiple Profiles",id:"using-multiple-profiles",level:2},{value:"Order of Execution",id:"order-of-execution",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"profiles",children:"Profiles"}),"\n",(0,r.jsx)(n.p,{children:'The Virtual Client defines the work/operations that will happen on a system in structured JSON documents called "profiles". Profiles can be thought\nof as recipes for how to utilize resources and to work the system. Profiles are divided into different sections within a profile including Metadata, Parameters,\nActions, Monitors and Dependencies.'}),"\n",(0,r.jsx)(n.p,{children:"Although a profile may contain any number of these sections, none of the sections are absolutely required. This allows users flexibility when creating profiles for\nreusability. For example, it is common for the Virtual Client team to have profiles specific to running workloads on the system separat from profiles specific to running\nmonitors on the system. This allows a user to run a set of monitors with any number of different sets of workloads. In the examples below, the profiles that start with the\nterm 'PERF' are ones that are designed to run workloads on the system. Profiles that start with the term 'MONITORS' are designed to run different sets of monitors on the\nsystem in the background while the workloads are running."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"VirtualClient.exe --profile=PERF-CPU-COREMARK.json --profile=MONITORS-DEFAULT.json ...\nVirtualClient.exe --profile=PERF-CPU-OPENSSL.json --profile=MONITORS-DEFAULT.json ...\nVirtualClient.exe --profile=PERF-IO-FIO.json --profile=MONITORS-DEFAULT.json ...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"metadata",children:"Metadata"}),"\n",(0,r.jsx)(n.p,{children:"The section 'Metadata' within the profile defines supplemental or context information on the purpose of the profile, general recommendations and designations for\nsupported OS platforms and CPU architectures. Metadata is generally meant to serve as informational only and do not affect the operations of the Virtual Client with\nregards to the profile. There are a few metadata instructions however that do affect the operations at runtime. The following table describes some of the common metadata\nproperties that one might find in a profile."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metadata Property"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default Value"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SupportsIterations"}),(0,r.jsx)(n.td,{children:"Optional. True/False. This metadata property DOES affect the operations of the Virtual Client. When set to false, it indicates that the profile does not support profile iterations (i.e. --iterations on the command line)."}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"RecommendedMinimumExecutionTime"}),(0,r.jsx)(n.td,{children:"Optional. Provides a recommendation for the minimum length of time for running the profile. This time is typically based on the amount of time expected to execute all actions in the profile 1 full round. Actions are generally executed in sequential order. Note that this is an estimate based on empirical evidence, but it is always a good idea to leave a little extra time buffer."}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SupportedPlatforms"}),(0,r.jsx)(n.td,{children:"Optional. Defines a set of OS platforms and CPU architectures on which the profile (and all components within) is confirmed to run correctly (e.g. win-x64 -> Windows OS, X64 architecture)."}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SupportedOperatingSystems"}),(0,r.jsx)(n.td,{children:"Optional. Defines a set of operating systems on which the profile is confirmed to run correctly (e.g. Ubuntu, CentOS, Windows). This list does not indicate that the Virtual Client will run on every version of these operating systems. Focus on latest versions of the operating systems for support."}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.p,{children:"The section 'Parameters' within the profile defines a set of 1 or more parameters (typically with default values) that can be used to override the default values in the components that\nare part of the 'Actions', 'Monitors' or 'Dependencies' sections. In general, Virtual Client profiles are not meant to be overly general purpose. They represent tested and vetted recipes\nfor how to utilize resources and work a given system. Whereas any number of parameters can be defined in the 'Parameters' section, it is common practice to allow overrides to a minimum\nset. This helps to ensure the purpose and consistency of the profile operations on the system cannnot diverge too far from the original intentions."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"Parameters": {\n    "CompilerName": "gcc",\n    "CompilerVersion": "10",\n    "ThreadCount": null\n},\n "Actions": [\n    {\n        "Type": "CoreMarkProExecutor",\n        "Parameters": {\n            "Scenario": "CoreMarkProBenchmark",\n            "PackageName": "coremarkpro"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"well-known-parameters",children:"Well-Known Parameters"}),"\n",(0,r.jsx)(n.p,{children:"There are certain parameters that can be used in a profile that represent aspects of the system that differ from one to another. These parameters are used to allow\ndesigners of profiles to be as expressive as possible with intentions. One of the express goals of the Virtual Client team with regards to profile design is\nto have profiles be as clear and self-describing as possible. It helps users to establish context into the purpose of the profile and what it will do when running on\nthe system. The following table describes the set of well-known parameters that can be used in profiles."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"LogicalCoreCount"}),(0,r.jsx)(n.td,{children:"Represents the number of logical cores/vCPUs on the system."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PhysicalCoreCount"}),(0,r.jsx)(n.td,{children:"Represents the number of physical cores on the system."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PackagePath:{package_name}"}),(0,r.jsx)(n.td,{children:"Represents the path to a package that is installed on the system by one of the dependency components (e.g. {PackagePath:openssl} ...resolving to /home/users/virtualclient/packages/openssl)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PackagePath/Platform:{package_name}"}),(0,r.jsxs)(n.td,{children:['Represents the "platform-specific" path to a package that is installed on the system by one of the dependency components. Platform-specific paths are a Virtual Client concept. They represent paths within a given package that contain toolsets and scripts for different OS platforms and CPU architectures  (e.g. {PackagePath/Platform',":openssl","} ...resolving to /home/users/virtualclient/packages/openssl/linux-x64, /home/users/virtualclient/packages/openssl/win-arm64)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Platform"}),(0,r.jsx)(n.td,{children:"Represents the platform-architecture for the system on which Virtual Client is running (e.g. linux-arm64, linux-x64, win-arm64, win-x64)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ScriptPath:{script_folder}"}),(0,r.jsx)(n.td,{children:"Represents the path to a script that is copied to the build output 'scripts' directory."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SystemMemoryBytes"}),(0,r.jsx)(n.td,{children:"Represents the total memory/RAM (in bytes) on the system."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SystemMemoryKilobytes"}),(0,r.jsx)(n.td,{children:"Represents the total memory/RAM (in kilobytes) on the system. Note that industry standard memory unit definitions are used (e.g. 1 kilobyte = 1024 bytes)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SystemMemoryMegabytes"}),(0,r.jsx)(n.td,{children:"Represents the total memory/RAM (in megabytes) on the system. Note that industry standard memory unit definitions are used (e.g. 1 megabyte = 1024 kilobytes or 1024 x 1024 bytes)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SystemMemoryGigabytes"}),(0,r.jsx)(n.td,{children:"Represents the total memory/RAM (in gigabytes) on the system. Note that industry standard memory unit definitions are used (e.g. 1 gigabyte = 1024 megabytes or 1024 x 1024 kilobytes or 1024 x 1024 x 1024 bytes)."})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Actions": [\n    {\n        "Type": "RedisServerExecutor",\n        "Parameters": {\n            "Scenario": "Server",\n            "PackageName": "redis",\n            "CommandLine": "--protected-mode no --io-threads {ServerThreadCount} --maxmemory-policy noeviction --ignore-warnings ARM64-COW-BUG --save",\n            "BindToCores": true,\n            "Port": "$.Parameters.ServerPort",\n            "ServerInstances": "{LogicalCoreCount}",\n            "ServerThreadCount": "$.Parameters.ServerThreadCount",\n            "Role": "Server"\n        }\n    }\n]\n\n"Dependencies": [\n    {\n        "Type": "WgetPackageInstallation",\n        "Parameters": {\n            "Scenario": "InstallMemcachedPackage",\n            "PackageName": "memcached",\n            "PackageUri": "https://memcached.org/files/memcached-1.6.17.tar.gz",\n            "SubPath": "memcached-1.6.17",\n            "Notes": "Example path to package -> /packages/memcached/memcached-1.6.17"\n        }\n    },\n    {\n        "Type": "ExecuteCommand",\n        "Parameters": {\n            "Scenario": "CompileMemcached",\n            "Platforms": "linux-x64,linux-arm64",\n            "Command": "bash -c \'./configure\'&&make",\n            "WorkingDirectory": "{PackagePath:memcached}"\n        }\n    }\n]\n\n"Dependencies": [\n    {\n        "Type": "DependencyPackageInstallation",\n        "Parameters": {\n            "Scenario": "InstallCoreMarkPackage",\n            "BlobContainer": "packages",\n            "BlobName": "coremark.1.0.0.zip",\n            "PackageName": "coremark",\n            "Extract": true\n        }\n    },\n    {\n        "Type": "ExecuteCommand",\n        "Parameters": {\n            "Scenario": "CompileCoremark",\n            "Platforms": "linux-x64,linux-arm64",\n            "Command": "bash -c \'./configure\'&&make",\n            "WorkingDirectory": "{PackagePath/Platform:coremark}"\n        }\n    }\n]\n\n"Dependencies": [\n    {\n        "Type": "DependencyPackageInstallation",\n        "Parameters": {\n            "Scenario": "InstallCustomToolsetPackage",\n            "BlobContainer": "packages",\n            "BlobName": "customtoolset-{Platform}.1.0.0.zip",\n            "PackageName": "customtoolset-{Platform}",\n            "Extract": true\n        }\n    },\n    {\n        "Type": "ExecuteCommand",\n        "Parameters": {\n            "Scenario": "InstallCustomToolset",\n            "Platforms": "{Platform}",\n            "Command": "bash -c \'install-toolset.sh\'",\n            "WorkingDirectory": "{PackagePath:customtoolset-{Platform}}"\n        }\n    }\n]\n\n"Actions": [\n\t{\n\t\t"Type": "FioExecutor",\n\t\t"Parameters": {\n\t\t\t"Scenario": "FioExecutorJobFile",\n\t\t\t"PackageName": "fio",\n\t\t\t"JobFile": "{ScriptPath:fio}/oltp-c.jobfile",\n\t\t\t"CommandLine": "--thread {JobFile}"\n\t\t}\n\t}\n]\n'})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Actions": [\n    {\n        "Type": "MemcachedServerExecutor",\n        "Parameters": {\n            "Scenario": "Server",\n            "PackageName": "memcached",\n            "CommandLine": "-p {Port} -t 4 -m {ServerMemory} -c {ServerMaxConnections}",\n            "BindToCores": true,\n            "Port": "$.Parameters.ServerPort",\n            "Username": "$.Parameters.Username",\n            "ServerThreadCount": 4,\n            "ServerMaxConnections": "$.Parameters.ServerMaxConnections",\n            "ServerMemory": "{calculate({SystemMemoryMegabytes} / 2)}",\n            "Role": "Server"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"inline-parameter-references",children:"Inline Parameter References"}),"\n",(0,r.jsx)(n.p,{children:'There are scenarios where the author of a profile would like to reference parameters defined in the set associated with the action, monitor or dependency within the value\nfor another parameter. This is typically used to allow global parameters to be defined at the profile level and then referenced parameters defined at the action level.\nThis technique is also used to help make profiles as "self-describing" as possible by avoiding the need to define values within the code itself (and thus out of site for a user\nof the application + profile). The following example illustrates how this works with a few variations on the concept.'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Global Parameter References"}),(0,r.jsx)(n.br,{}),"\n",'The parameters at the top of a profile are "global" parameters meaning that they can be applied to any of the action, monitor or dependency components within the profile.\nGlobal profile parameters can be overridden on the command line by a user of the Virtual Client. This is helpful for allowing a user to have a bit more flexibility into the\nbehavior of Virtual Client when running the profile. For example, a common use case it to allow the user to explicitly define the number of threads that should be used when\nrunning a workload thus enabling he/she to tailor the workload to systems with different amounts of CPU resources.']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// The \'ThreadCount\' parameter defined in the profile global parameters is\n// referenced in an individual action.\n{\n  "Description": "CoreMark Performance Workload",\n  "Metadata": {\n  },\n  "Parameters": {\n      "ThreadCount": 8\n  },\n  "Actions": [\n      {\n          "Type": "CoreMarkExecutor",\n          "Parameters": {\n              "Scenario": "ScoreSystem",\n              "PackageName": "coremark",\n              "ThreadCount": "$.Parameters.ThreadCount"\n          }\n      }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# A user of the Virtual Client could then define different values for the \'ThreadCount\' parameter on the \n# command line if desired.\nVirtualClient.exe --profile=EXAMPLE-PROFILE.json --parameters="ThreadCount=4"\nVirtualClient.exe --profile=EXAMPLE-PROFILE.json --parameters="ThreadCount=16"\nVirtualClient.exe --profile=EXAMPLE-PROFILE.json --parameters="ThreadCount=32"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Component Inline Parameter References"}),"\nThe parameters within a given component can themselves reference the values of other parameters within the same component. This is often used to make\nusage patterns clear and self-describing within the profile. Note that this is not supported for all profiles. There is an implementation requirement in\nVirtual Client required. However, the user can typical determine if a profile supports it because it will be using it already."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// Below the parameters FileSize, QueueDepth and ThreadCount are used in the value of the CommandLine parameter.\n// Additionally, the FileSize parameter is a global parameter. This illustrates combining the 2 techniques together \n// in a single profile.\n{\n  "Description": "FIO I/O Stress Performance Workload",\n  "Metadata": {\n  },\n  "Parameters": {\n      "FileSize": "496G"\n  },\n  "Actions": [\n      {\n          "Type": "FioExecutor",\n          "Parameters": {\n              "Scenario": "RandomWrite_4k_BlockSize",\n              "PackageName": "fio",\n              "CommandLine": "--name=fio_randwrite_{FileSize}_4k_d{QueueDepth}_th{ThreadCount} --size={FileSize} --numjobs={ThreadCount} --rw=randwrite --bs=4k --iodepth={QueueDepth} ...",\n              "FileSize": "$.Parameters.FileSize",\n              "QueueDepth": 32,\n              "ThreadCount": 16\n          }\n      }\n  ]\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"inline-parameter-references---time-spans",children:"Inline Parameter References -> Time Spans"}),"\n",(0,r.jsx)(n.p,{children:"Time span parameters are very common in profiles (e.g. Duration: 00:30:00) and are often used to describe a time ranges or timeouts for executing operations.\nIt is sometimes beneficial to be able to reference a duration as different units of time. The table below describes the different units of time that are supported for\ntime span parameter references in Virtual Client profiles."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"{ParameterName.TotalDays}"}),(0,r.jsx)(n.td,{children:"Given a parameter with a value formatted as a time span (e.g. 11.00:00:00) in a set of profile parameters, this represents the total number of days for the range of time defined by the time span value (e.g. 11.00:00:00 -> 11 days)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"{ParameterName.TotalHours}"}),(0,r.jsx)(n.td,{children:"Given a parameter with a value formatted as a time span (e.g. 05:00:00) in a set of profile parameters, this represents the total number of hours for the range of time defined by the time span value (e.g. 05:00:00 -> 5 hours)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"{ParameterName.TotalMilliseconds}"}),(0,r.jsx)(n.td,{children:"Given a parameter with a value formatted as a time span (e.g. 00:02:00) in a set of profile parameters, this represents the total number of milliseconds for the range of time defined by the time span value (e.g. 00:02:00 -> 120000 milliseconds)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"{ParameterName.TotalMinutes}"}),(0,r.jsx)(n.td,{children:"Given a parameter with a value formatted as a time span (e.g. 00:30:00) in a set of profile parameters, this represents the total number of minutes for the range of time defined by the time span value (e.g. 00:30:00 -> 30 minutes)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"{ParameterName.TotalSeconds}"}),(0,r.jsx)(n.td,{children:"Given a parameter with a value formatted as a time span (e.g. 00:30:00) in a set of profile parameters, this represents the total number of seconds for the range of time defined by the time span value (e.g. 00:01:00 -> 60 seconds)."})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Actions": [\n    {\n        "Type": "DiskSpdExecutor",\n        "Parameters": {\n            "Scenario": "RandomWrite_8k_BlockSize",\n            "PackageName": "diskspd",\n            "DiskFilter": "$.Parameters.DiskFilter",\n            "CommandLine": "-c496G -b8K -r4K -t32 -o128 -w100 -d{Duration.TotalSeconds} -Suw -W15 -D -L -Rtext",\n            "TestName": "diskspd_randwrite_496g_8k_d128_th32",\n            "FileName": "diskspd-test.dat",\n            "Duration": "00:05:00",\n            "Configuration": "Stress",\n            "ProcessModel": "$.Parameters.ProcessModel",\n            "DeleteTestFilesOnFinish": false,\n            "Tags": "IO,DiskSpd,randwrite"\n        }\n    }\n]\n\n"Actions": [\n    {\n        "Type": "DiskSpdExecutor",\n        "Parameters": {\n            "Scenario": "RandomWrite_8k_BlockSize",\n            "PackageName": "diskspd",\n            "DiskFilter": "$.Parameters.DiskFilter",\n            "CommandLine": "-c496G -b8K -r4K -t32 -o128 -w100 -d{Timeout.TotalSeconds} -Suw -W15 -D -L -Rtext",\n            "TestName": "diskspd_randwrite_496g_8k_d128_th32",\n            "FileName": "diskspd-test.dat",\n            "Timeout": "00:05:00",\n            "Configuration": "Stress",\n            "ProcessModel": "$.Parameters.ProcessModel",\n            "DeleteTestFilesOnFinish": false,\n            "Tags": "IO,DiskSpd,randwrite"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"inline-parameter-references---calculations",children:"Inline Parameter References -> Calculations"}),"\n",(0,r.jsx)(n.p,{children:'In addition to the different types of parameter references above, Virtual Client also has limited support for using calculations in parameter values. One of the fundamental\ngoals when defining profiles is to make the "recipe" as self-describing as possible. Inline calculations helps to make this possible with certain types of scenarios. For example,\nthe author may want to adjust the number of concurrent threads that are used to run a given workload depending upon the size of the system on which Virtual Client is running.\nWhereas this could certainly be done in the code itself, it hides the calculations from the user/reader of the profile. Calculations are often used in conjunction with the well-known\nparameters described above. The following examples illustrate how to use calculations in profiles.'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/dotnet/roslyn/blob/main/docs/wiki/Scripting-API-Samples.md",children:"CSharp Scripting Support"}),(0,r.jsx)(n.br,{}),"\n","Support for performing calculations against string literals is possible using the Roslyn compiler and scripting foundation in .NET. More specifically, the 'Microsoft.CodeAnalysis.CSharp.Scripting' library is used\nto translate string literals into mathematical calculations."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Calculations in parameter values should use the following format:  \n{calculate(<expression>)}\n\ne.g.\n{calculate(100 / {TotalThreads})}\n{calculate({LogicalCoreCount} - 2)}\n{calculate(({LogicalCoreCount} - 2) / 512)}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Actions": [\n  {\n      "Type": "DiskSpdExecutor",\n      "Parameters": {\n          "Scenario": "RandomWrite_4k_BlockSize",\n          "PackageName": "diskspd",\n          "DiskFilter": "$.Parameters.DiskFilter",\n          "CommandLine": "-c496G -b4K -r4K -t{calculate({LogicalCoreCount}/2)} -o{calculate(512/{ThreadCount})} -w100 -d300 -Suw -W15 -D -L -Rtext",\n          "FileName": "diskspd-test.dat",\n          "ProcessModel": "SingleProcess",\n          "DeleteTestFilesOnFinish": false,\n          "Tags": "IO,DiskSpd,randwrite"\n      }\n  }\n]\n\n// Calculations can be used to define the value of parameters which are then themselves\n// referenced in the values of other parameters (e.g. ThreadCount and QueueDepth below).\n"Actions": [\n  {\n      "Type": "DiskSpdExecutor",\n      "Parameters": {\n          "Scenario": "RandomWrite_4k_BlockSize",\n          "PackageName": "diskspd",\n          "DiskFilter": "$.Parameters.DiskFilter",\n          "CommandLine": "-c{FileSize} -b4K -r4K -t{ThreadCount} -o{QueueDepth} -w100 -d{Duration} -Suw -W15 -D -L -Rtext",\n          "TestName": "diskspd_randwrite_{FileSize}_4k_d{ThreadCount}_th{ThreadCount}",\n          "Duration": "$.Parameters.Duration",\n          "ThreadCount": "{calculate({LogicalCoreCount}/2)}",\n          "QueueDepth": "{calculate(512/{ThreadCount})}",\n          "FileSize": "$.Parameters.FileSize",\n          "FileName": "diskspd-test.dat",\n          "ProcessModel": "SingleProcess",\n          "DeleteTestFilesOnFinish": false,\n          "Tags": "IO,DiskSpd,randwrite"\n      }\n  }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,r.jsx)(n.p,{children:"The section 'Actions' within the profile defines a set of 1 or more toolsets to execute on the system. The term 'workload' is often used synonymously with 'Actions' to\ndescribe the software that is the focus of the work Virtual Client will perform on the system. For example, the section might include an action responsible for executing\nthe GeekBench5 toolset/workload on the system."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Actions": [\n    {\n        "Type": "GeekbenchExecutor",\n        "Parameters": {\n            "Scenario": "ScoreSystem",\n            "CommandLine": "--no-upload",\n            "PackageName": "geekbench5"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"The section 'Dependencies' within the profile defines a set of 1 or more dependencies that must be installed/provisioned on the system in order to run the\ntoolsets associated with the 'Actions' and 'Monitors'. For example, there may be packages that contain the toolsets that must be downloaded or Git repos to clone."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Dependencies": [\n    {\n        "Type": "CompilerInstallation",\n        "Parameters": {\n            "Scenario": "InstallCompiler",\n            "CompilerName": "$.Parameters.CompilerName",\n            "CompilerVersion": "$.Parameters.CompilerVersion"\n        }\n    },\n    {\n        "Type": "GitRepoClone",\n        "Parameters": {\n            "Scenario": "InstallCoreMarkPro",\n            "RepoUri": "https://github.com/eembc/coremark-pro.git",\n            "PackageName": "coremarkpro"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"monitors",children:"Monitors"}),"\n",(0,r.jsx)(n.p,{children:"The section 'Monitors' with the profile defines a set of 1 or more toolsets to run in the background capturing information from the system while 'Actions' are running.\nFor example, it is common practice to capture performance counters from the system while workloads are running. This enables users to get a good idea of the resources\nrequired to support the workloads and how the operating system + hardware is operating while under duress. Monitors always run in-parallel with the actions/workloads."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"Monitors": [\n    {\n        "Type": "PerfCounterMonitor",\n        "Parameters": {\n            "Scenario": "CaptureCounters",\n            "MonitorFrequency": "$.Parameters.MonitorFrequency",\n            "MonitorWarmupPeriod": "$.Parameters.MonitorWarmupPeriod"\n        }\n    },\n    {\n        "Type": "LspciMonitor",\n        "Parameters": {\n        "Scenario": "CaptureDeviceInformation",\n        "MonitorFrequency": "12:00:00",\n        "MonitorWarmupPeriod": "$.Parameters.MonitorWarmupPeriod"\n        }\n    }\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"using-multiple-profiles",children:"Using Multiple Profiles"}),"\n",(0,r.jsx)(n.p,{children:"Virtual Client allows the user to define any number of profiles on the command line. When multiple profiles are defined on the command line, they are merged into a\nsingle profile by the Virtual Client and then executed. The components are merged in the exact order as the profiles they exist within as supplied on the command line.\nFor the sake of telemetry, the very first profile defined will be the one used in the information output."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# For Example, given the following command line:\nVirtualClient.exe --profile=PROFILE1.json --profile=PROFILE2.json --profile=MONITORS1.json\n\n# ...And given the profiles have components as follows:\n[PROFILE1.json]\n  - Actions:\n       - Action 1\n       - Action 2\n\n  - Dependencies:\n       - Dependency 1\n       - Dependency 2\n\n[PROFILE2.json]\n  - Actions:\n       - Action 3\n       - Action 4\n\n  - Dependencies:\n       - Dependency 3\n       - Dependency 4\n\n[MONITORS1.json]\n  - Monitors:\n       - Monitor 1\n       - Monitor 2\n\n  - Dependencies:\n       - Dependency 3\n       - Dependency 4\n\n# ...Virtual Client will merge the 3 profiles into 1 before execution with components merged in the order supplied\n#    on the commandline. The very first profile defined on the command line will be used for telemetry purposes.\n[PROFILE1.json]\n  - Actions:\n       - Action 1\n       - Action 2\n       - Action 3\n       - Action 4\n\n  - Dependencies:\n       - Dependency 1\n       - Dependency 2\n       - Dependency 3\n       - Dependency 4\n\n  - Monitors:\n       - Monitor 1\n       - Monitor 2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"order-of-execution",children:"Order of Execution"}),"\n",(0,r.jsx)(n.p,{children:"Additionally, there is an order to the execution of components within a profile by the Virtual Client. Components in the 'Dependencies'\nsection are all executed first and in sequential order as they are defined within the profile. After the dependencies are executed, the components within the 'Monitors' section are executed.\nMonitors differ from other types of components in that they are executed in-parallel. Finally, the components within the 'Actions' section are execute. Actions are executed in\nsequential order as they are defined within the profile. These components begin execution almost as soon as the monitor components have started."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Profile Execution\n----\x3e 1) Dependencies\n\n----\x3e 2) Monitors  (all in-parallel)\n-----------\x3e Monitor 1, Monitor 2, Monitor 3\n\n----\x3e 3) Actions (in sequential order just as soon as the monitors are running)\n-----------\x3e Action 1 \n-----------\x3e Action 2\n-----------\x3e Action 3\n-----------\x3e Action 4\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.ah)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},3905:(e,n,t)=>{t.d(n,{ah:()=>c});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),m=c(t),p=i,u=m["".concat(l,".").concat(p)]||m[p]||d[p]||a;return t?r.createElement(u,o(o({ref:n},h),{},{components:t})):r.createElement(u,o({ref:n},h))}));h.displayName="MDXCreateElement"}}]);