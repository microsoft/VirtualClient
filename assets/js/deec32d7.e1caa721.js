"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[9784],{2380:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var o=t(5893),i=t(3905);const r={},s="Azure Storage Account Integration",a={id:"guides/0600-integration-blob-storage",title:"Azure Storage Account Integration",description:"Virtual Client supports a few different types of Azure Blob stores that can be used as part of a workload profile execution. This documentation",source:"@site/docs/guides/0600-integration-blob-storage.md",sourceDirName:"guides",slug:"/guides/0600-integration-blob-storage",permalink:"/VirtualClient/docs/guides/0600-integration-blob-storage",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/guides/0600-integration-blob-storage.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Usage: Using Custom Extensions",permalink:"/VirtualClient/docs/guides/0221-usage-extensions"},next:{title:"Azure Event Hub Integration",permalink:"/VirtualClient/docs/guides/0610-integration-event-hub"}},l={},c=[{value:"Supported Blob Stores",id:"supported-blob-stores",level:2},{value:"Blob Store Authentication",id:"blob-store-authentication",level:2},{value:"Blob Store Folder/File Naming Conventions",id:"blob-store-folderfile-naming-conventions",level:3},{value:"Integration with the Development Process",id:"integration-with-the-development-process",level:3},{value:"How Blob Stores are Integrated into Dependencies",id:"how-blob-stores-are-integrated-into-dependencies",level:5}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h5:"h5",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.ah)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"azure-storage-account-integration",children:"Azure Storage Account Integration"}),"\n",(0,o.jsx)(n.p,{children:"Virtual Client supports a few different types of Azure Blob stores that can be used as part of a workload profile execution. This documentation\ncovers how to supply those blob stores to the Virtual Client on the command line as well as how to use them in Virtual Client codebase."}),"\n",(0,o.jsx)(n.h2,{id:"supported-blob-stores",children:"Supported Blob Stores"}),"\n",(0,o.jsx)(n.p,{children:"The following stores are supported by the Virtual Client. The stores must be Azure Storage Account blob stores."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Packages Store"}),(0,o.jsx)(n.br,{}),"\n","The packages blob store contains workload and dependency packages that must be downloaded to a system during the execution of a\nworkload profile. These are typically NuGet/zip files that contain binaries, scripts, etc... that are required by the scenario profile."]}),"\n",(0,o.jsx)(n.p,{children:"The packages store can be supplied to the Virtual Client on the command line using the '--packageStore' parameter and supplying the\nfull connection string to the Azure storage account blob resource."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# The blob container does not require authentication (i.e. blob-anonymous read access)\nVirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --packageStore="https://any.blob.core.windows.net"\n\n# The blob continer requires authentication (e.g. a SAS token)\nVirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --packageStore="https://any.blob.core.windows.net/packages?sp=r&st=2022-05-09T18:31:45Z&se=2030-05-10T02:31:45Z&spr=https&sv=2020-08-04&sr=c&sig=..."\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"packages store",src:t(3702).Z+"",width:"1179",height:"479"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Content Store"}),(0,o.jsx)(n.br,{}),"\n","The content blob store is used for uploading files and content captured by workloads or monitors that run as part of Virtual Client workload\noperations. For example, a monitor might be implemented to upload certain types of logs, bin files or cab files to the specified content blob\nstore."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# The blob container does not require authentication (i.e. blob-anonymous read access)\nVirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --contentStore="https://any.blob.core.windows.net"\n\n# The blob continer requires authentication (e.g. a SAS token)\nVirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --contentStore="https://any.blob.core.windows.net/packages?sp=r&st=2022-05-09T18:31:45Z&se=2030-05-10T02:31:45Z&spr=https&sv=2020-08-04&sr=c&sig=..."\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"monitoring content",src:t(9385).Z+"",width:"1350",height:"530"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"blob-store-authentication",children:"Blob Store Authentication"}),"\n",(0,o.jsx)(n.p,{children:"Virtual Client supports the following authentication options for all blob stores:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview",children:"Shared Access Signatures (SAS) Overview"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/rest/api/storageservices/create-account-sas?redirectedfrom=MSDN",children:"Account Shared Access Signatures"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Azure Entra Id + Certificate using thumbprint"}),"\nVC uses certificate to authenticate with an Azure Entra ID (AAD) application, which has read access to the package store.\nThis method uses certificate thumbprint to search for the certificate. Required parameters are:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"CertificateThumbprint"}),"\n",(0,o.jsx)(n.li,{children:"ClientId"}),"\n",(0,o.jsx)(n.li,{children:"TenantId"}),"\n",(0,o.jsx)(n.li,{children:"EndpointUrl"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"--packages=CertificateThumbprint=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;ClientId=BBBBBBBB-BBBB-BBBB-BBBB-BBBBBBBBBBBB;TenantId=CCCCCCCC-CCCC-CCCC-CCCC-CCCCCCCCCCCC;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Azure Entra Id + Certificate using issuer + subject"}),"\nVC uses certificate to authenticate with an Azure Entra ID (AAD) application, which has read access to the package store.\nThis method uses certificate issuer + subject to search for the certificate. This has the benefit of supporting frequent cert rotation with no argument changes. The issuer can be a substring of the exact issuer appearing in the certificate. The search only looks for contains.\nRequired parameters are:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"CertificateIssuer"}),"\n",(0,o.jsx)(n.li,{children:"CertificateSubject"}),"\n",(0,o.jsx)(n.li,{children:"ClientId"}),"\n",(0,o.jsx)(n.li,{children:"TenantId"}),"\n",(0,o.jsx)(n.li,{children:"EndpointUrl"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"--packages=CertificateIssuer=XXX CA Authority;CertificateSubject=aaa.bbb.com;ClientId=BBBBBBBB-BBBB-BBBB-BBBB-BBBBBBBBBBBB;TenantId=CCCCCCCC-CCCC-CCCC-CCCC-CCCCCCCCCCCC;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Azure Managed Identity"}),"\nThis method uses Azure managed identity to authenticate. An id is required to support cases where a machine have multiple identities."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"--packages=ManagedIdentityId=AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Blob Service SAS URI"}),(0,o.jsx)(n.br,{}),"\n","This is a SAS URI to the Blob service in the storage account. This provides exactly the same types of privileges as the Blob service-level connection string noted above."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"(e.g. https://anystorageaccount.blob.core.windows.net/?sv=2020-08-04&ss=b&srt=c&sp=rwlacx&se=2021-11-23T14:30:18Z&st=2021-11-23T02:19:18Z&spr=https&sig=jcql6El...)"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Blob Container SAS URI"}),(0,o.jsx)(n.br,{}),"\n","This is a SAS URI to a single blob container within the storage account. This is the most restrictive way of providing privileges but is also the most secure because it\nprovides the least amount of access to the application. This is a good fit for scenarios where all content (e.g. across all monitors) is uploaded to a single container\nwithin the blob store."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"(e.g. https://anystorageaccount.blob.core.windows.net/packages?sp=r&st=2021-11-23T18:22:49Z&se=2021-11-24T02:22:49Z&spr=https&sv=2020-08-04&sr=c&sig=ndyPRH...)"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Storage Account Connection String (Deprecated)"}),(0,o.jsx)(n.br,{}),"\n","The primary or secondary connection string to the Azure storage account. This provides full access privileges to the entire\nstorage account but the least amount of security. This is generally recommended only for testing scenarios. The use of a\nSAS URI or connection string is preferred because it enables finer grained control of the exact resources within the storage\naccount that the application should be able to access."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"(e.g. DefaultEndpointsProtocol=https;AccountName=anystorageaccount;AccountKey=w7Q+BxLw...;EndpointSuffix=core.windows.net)"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Blob Service Connection String (Deprecated)"}),(0,o.jsx)(n.br,{}),"\n","This is a connection string to the Blob service in the storage account. It allows user-defined/restricted access privileges to be defined for\nall containers and blobs in the storage account. This is a good fit for scenarios where content (e.g. from different monitors) is uploaded to\ndifferent containers within the blob store and thus the application needs access to all containers."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"(e.g. BlobEndpoint=https://anystorageaccount.blob.core.windows.net/;SharedAccessSignature=sv=2020-08-04&ss=b&srt=c&sp=rwlacx&se=2021-11-23T14:30:18Z&st=2021-11-23T02:19:18Z&spr=https&sig=jcql6El...)"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Use the following recommendations when creating shared access keys in the blob store to ensure the right amount of privileges\nare granted to the Virtual Client application for uploading and downloading blobs."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Blob Service Connection Strings or SAS URIs"}),(0,o.jsx)(n.br,{}),"\n","Select the following options when defining shared access signatures at the Blob service level:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Allowed services = Blob"}),"\n",(0,o.jsx)(n.li,{children:"Allowed resource types = Container, Object"}),"\n",(0,o.jsx)(n.li,{children:"Allowed permissions = Read, Write, Create"}),"\n",(0,o.jsx)(n.li,{children:"Allowed protocols = HTTPS only"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(379).Z+"",width:"1357",height:"914"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Blob Container SAS URIs"}),(0,o.jsx)(n.br,{}),"\n","Select the following options when defining shared access signatures at the Blob container level:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Signing method = Account key"}),"\n",(0,o.jsx)(n.li,{children:"Permissions = Read, Write, Create"}),"\n",(0,o.jsx)(n.li,{children:"Allowed protocols = HTTPS only"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(9889).Z+"",width:"1000",height:"743"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"blob-store-folderfile-naming-conventions",children:"Blob Store Folder/File Naming Conventions"}),"\n",(0,o.jsx)(n.p,{children:"In  order to ensure that files associated with Virtual Client executors or monitors are easy to find in the blob stores, Virtual Client supports a flexible blob path template.\nAt a high level, all files associated with a given experiment are contained together in the blob store."}),"\n",(0,o.jsx)(n.p,{children:'The virtual path of uploaded logs in blob storage is controlled by a VirtualClient Command Line Option parameter "--contentPathTemplate".'}),"\n",(0,o.jsx)(n.p,{children:'Example: --contentPathTemplate="any-value1/<standardProperty1>any-value2<standardProperty2>/<standardProperty3>/any-value3/<standardProperty4>".'}),"\n",(0,o.jsxs)(n.p,{children:["In above example, the virtual blob folder structure will have sub-folders corresponding to each element separated by a '/' in the\nContentPathTemplate. The inlined values that are enclosed within brackets \"",'", like "standaradProperty1" and "standaradProperty2",\nneeds to be one among the 5 defined standard properties of Virtual Client (ExperimentId, AgentId, ToolName, Role, Scenario).']}),"\n",(0,o.jsx)(n.p,{children:"The first component of ContentPathTemplate (any-value1 in above example) will be taken up as the name of Blob storage Container where all files will be uploaded.\nThe next component (<standardProperty1> in above example) will be the root folder within the container and so on for the complete virtual folder structure within the blob storage."}),"\n",(0,o.jsxs)(n.p,{children:['The default value of "ContentPathTemplate" is ',(0,o.jsx)(n.code,{children:"{experimentId}/{agentId}/{toolName}/{role}/{scenario}"}),". In the default template, each element\nis a standard property identified by Virtual Client."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Experiment ID"}),(0,o.jsx)(n.br,{}),"\n","The ID of the experiment is used to ensure all files associated with any executors or monitors are in the same virtual folder within the blob store.\nFurthermore because an experiment ID is a global identifier, it is easier for the user or automation to find files associated with a given experiment\n(e.g. for debugging/triage)."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Agent ID"}),(0,o.jsx)(n.br,{}),"\n","The ID of the Virtual Client instance running (i.e. the agent) is also included. This ensures that files captured from a specific VM or node etc... are easy\nto distinguish from each other."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Tool Name"}),(0,o.jsx)(n.br,{}),"\n","This is the name of the executor or monitor that created the files (directly or indirectly)."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Role"}),(0,o.jsx)(n.br,{}),"\n","This is relevant for workloads that use multiple systems, and each system has an assigned role like Client or Server."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"ScenarioName"}),(0,o.jsx)(n.br,{}),"\n","It is an indicator of the scenario being tested by the workload. It is defined for each action/monitor in an execution profile."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"All files will be uploaded in a virtual folder structure as defined by the ContentPathTemplate. For each file uploaded, a timestamp will be\nprefixed to it so as to provide unique names."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"File Name"}),(0,o.jsx)(n.br,{}),"\n","This is the name of the file as it should be reflected in the blob store. A timestamp (round-trip date/time format) will be added to the beginning of the file name\n(e.g. 2023-08-17t0637583781z-monitor.log). The addition of the timestamp ensures that the files within a given virtual folder in the blob store will all\nhave unique names in order to avoid collisions. Round-trip date/time formats in addition to being a valid timestamp are naturally sortable in UX experiences\nsuch as a web browser."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Round-Trip Formatted Timestamp"}),(0,o.jsx)(n.br,{}),"\n","As noted above, a round-trip formatted timestamp will be added to each file name to ensure uniqueness."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Given the pieces of information noted above, the format for virtual paths and file names will look like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'// ContentPathTemplate and Parameters as defined in Virtual Client CommandLine:\n// -----------------------------------------------\nVirtualClient.exe --profile=........ --contentPathTemplate="value1/expt_{experimentId}_agent_{agentId}/{toolName}/value-2" \n\n// Examples:\n// -----------------------------------------------\n// Given the Following Information:\n// - Experiment ID = 24149a49-66c9-4bd1-9332-18370c7c70e1\n// - Agent ID = cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01\n// - ToolName - a Background Monitor = exampleMonitor\n// - Files Produced = monitor.log\n//\n// The blob virtual folder paths/names would like the following:\nvalue1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:32:27.1237655Z-monitor.log\nvalue1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:34:32.6483092Z-monitor.log\nvalue1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:36:30.2645013Z-monitor.log\n\n// Structure Within the Blob Store:\n// -----------------------------------------------\n// (container) value1 \n//   -> (virtual folder) /expt_24149a49-66c9-4bd1-9332-18370c7c70e1_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01\n//     -> (virtual folder) /examplemonitor\n//       -> (virtual folder) /value-2\n//         -> (blob) 2022-03-07T01:32:27.1237655Z-monitor.log\n//         -> (blob) 2022-03-07T01:34:32.6483092Z-monitor.log\n//         -> (blob) 2022-03-07T01:36:30.2645013Z-monitor.log\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"integration-with-the-development-process",children:"Integration with the Development Process"}),"\n",(0,o.jsx)(n.p,{children:"This section describes how access to the supported blob stores can be integrated into the Virtual Client process."}),"\n",(0,o.jsx)(n.h5,{id:"how-blob-stores-are-integrated-into-dependencies",children:"How Blob Stores are Integrated into Dependencies"}),"\n",(0,o.jsx)(n.p,{children:"When the Virtual Client reads the blob stores (i.e. connection strings) from the command line, it will place a set of\nBlobStore objects into the dependencies collection that is passed into the constructors of ALL profile actions, dependencies\nand monitors."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:"// In the CommandBase class in the Main project\nList<BlobStore> blobStores = new List<BlobStore>();\nif (this.ContentBlobStore != null)\n{\n    blobStores.Add(this.ContentBlobStore);\n}\n\nif (this.PackagesBlobStore != null)\n{\n    blobStores.Add(this.PackagesBlobStore);\n}\n\nIServiceCollection dependencies = new ServiceCollection();\n...\ndependencies.AddSingleton<IEnumerable<BlobStore>>(blobStores);\n"})}),"\n",(0,o.jsx)(n.p,{children:"Each of the BlobStore instances describes a single blob store that can be then used within any of the components described\nin the profile. To use upload or download blobs from one of the stores, create a BlobManager instance. The blob manager has\nsimple download and upload methods available."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Monitors/ExampleMonitorWithBlobUploadIntegration.cs",children:"Example Implementation/Usage"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'// Using the example implementation noted above:\n//\n// Get the blob store reference and create a BlobManager to upload blobs to the store.\nif (this.TryGetContentStore(out BlobStore contentStore))\n{\n    DateTime snapshotTime = DateTime.UtcNow;\n    IBlobManager blobManager = new BlobManager(contentStore.ConnectionString);\n\n    // For this example, assume there is a file that contains the output of some monitoring\n    // toolset. We want to upload this file to the content blob store.\n    using (FileStream uploadStream = new FileStream(resultsFilePath, FileMode.Open, FileAccess.Read, FileShare.Read))\n    {\n        BlobDescriptor resultsBlob = new BlobDescriptor\n        {\n            // For this scenario, we have a folder structure and naming convention for each of the blobs\n            // that is specific to the monitor but that also allows for consecutive blobs to be uploaded without\n            // overwriting previously uploaded blobs.\n            //\n            // Example:\n            // Given an experiment ID = 24149a49-66c9-4bd1-9332-18370c7c70e1 and an Agent ID = cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01:\n            //\n            // Format = 24149a49-66c9-4bd1-9332-18370c7c70e1/cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/2022-03-07T01:32:27.1237655Z-monitor.log\n            BlobName = BlobDescriptor.ToPath(this.ExperimentId, this.AgentId, "examplemonitor", "monitor.log"),\n            ContainerName = "monitors",\n            ContentEncoding = Encoding.UTF8,\n            ContentType = "text/plain"\n        };\n\n        await blobManager.UploadBlobAsync(resultsBlob, uploadStream, cancellationToken)\n            .ConfigureAwait(false);\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.ah)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3905:(e,n,t)=>{t.d(n,{ah:()=>c});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=o.createContext({}),c=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},h=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,h=a(e,["components","mdxType","originalType","parentName"]),p=c(t),u=i,b=p["".concat(l,".").concat(u)]||p[u]||d[u]||r;return t?o.createElement(b,s(s({ref:n},h),{},{components:t})):o.createElement(b,s({ref:n},h))}));h.displayName="MDXCreateElement"},9889:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/blob-container-sas-1-92090121e019eb6d574ed1e48d2ec0ea.png"},379:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/blob-service-sas-1-913224b9cf8a2c796f3d819b91939292.png"},3702:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/blob-storage-support-1-d9b6235d6d18b00cc7b4386411085260.png"},9385:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/blob-storage-support-2-47336ce50b38a5094f58f1be47565aeb.png"}}]);