<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-overview/design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Platform Design | Virtual Client Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/VirtualClient/docs/overview/design/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="performance, benchmarking, automation, framework, microsoft"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Platform Design | Virtual Client Platform"><meta data-rh="true" name="description" content="The following sections cover important design aspects of the Virtual Client platform application. This document is written for engineers and technical roles who"><meta data-rh="true" property="og:description" content="The following sections cover important design aspects of the Virtual Client platform application. This document is written for engineers and technical roles who"><link data-rh="true" rel="icon" href="/VirtualClient/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/VirtualClient/docs/overview/design/"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/VirtualClient/docs/overview/design/" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/VirtualClient/docs/overview/design/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0I7D8A07MA-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/VirtualClient/blog/rss.xml" title="Virtual Client Platform RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/VirtualClient/blog/atom.xml" title="Virtual Client Platform Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Virtual Client Platform" href="/VirtualClient/opensearch.xml"><link rel="stylesheet" href="/VirtualClient/assets/css/styles.9af2558c.css">
<script src="/VirtualClient/assets/js/runtime~main.24512b64.js" defer="defer"></script>
<script src="/VirtualClient/assets/js/main.cea975e9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like VirtualClient, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/VirtualClient">GitHub</a> ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/VirtualClient/"><div class="navbar__logo"><img src="/VirtualClient/img/vc-logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/VirtualClient/img/vc-logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Virtual Client</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/VirtualClient/docs/overview/">Documentation</a><a class="navbar__item navbar__link" href="/VirtualClient/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/VirtualClient" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/VirtualClient/docs/category/overview/">Overview</a><button aria-label="Collapse sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/overview/">Platform Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/overview/features/">Platform Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/VirtualClient/docs/overview/design/">Platform Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/overview/roadmap/">Platform Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/overview/faq/">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/guides/">Guides</a><button aria-label="Expand sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/workloads/">Workloads</a><button aria-label="Expand sidebar category &#x27;Workloads&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/monitors/">Monitors</a><button aria-label="Expand sidebar category &#x27;Monitors&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/dependencies/">Dependencies</a><button aria-label="Expand sidebar category &#x27;Dependencies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/developing/">Developing</a><button aria-label="Expand sidebar category &#x27;Developing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/VirtualClient/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/VirtualClient/docs/category/overview/"><span itemprop="name">Overview</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Platform Design</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="platform-design">Platform Design</h1>
<p>The following sections cover important design aspects of the Virtual Client platform application. This document is written for engineers and technical roles who
are interested in how the Virtual Client platform and application is designed. The application itself is a .NET 8.0 command line application written in C# that
is has both cross-platform and multi-architecture support. It is compiled to support both Windows and Linux operating system platforms as well as x64 and arm64
architectures. The choice to implement the application using managed code was made to enable a foundation for ease-of-rapid feature development at the same time
as meeting all of the requirements for cross-platform + architecture support. Additionally, the .NET 8.0 framework integrates all of the performance and runtime
efficiency work done by the .NET Core team over the past 5 years into a unified platform.</p>
<h2 id="application-concepts">Application Concepts</h2>
<p>The following sections describes some of the high-level concepts and features sets of the Virtual Client platform.</p>
<h3 id="workloadtest-profiles">Workload/Test Profiles</h3>
<p>Workload profiles define a set of one or more different ways to run a given workload or test on a system. The primary goal of these workload profiles is to evaluate the system
in a wide range of different ways. This in turn ensures that each round of execution of a workload on the Virtual Client platform can produce a breadth and depth of results
that are useful in comparing the performance of the system. Each of the workload profiles are tailored based on feedback from subject matter expert teams in the
Azure organization as well as from empirical evidence derived from running them in large-scale experiments. The Virtual Client has ran on more than
a million VM systems (Windows and Linux) in the Azure cloud.</p>
<ul>
<li><a href="/VirtualClient/docs/overview/">Workloads and Profiles Supported</a></li>
<li><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Main/profiles/PERF-CPU-OPENSSL.json&amp;version=GBmaster">Example Profile</a></li>
<li><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Main/profiles">Profiles Supported</a></li>
<li><a href="/VirtualClient/docs/guides/0200-usage-examples">Usage Examples</a></li>
</ul>
<p>Using the example below as a reference, there are a 3 different fundamental sections inside a workload profile:</p>
<ul>
<li>
<p><strong>Parameters</strong><br>
<!-- -->At the top of most workload profiles are a set of one or more parameters. These parameters are referenced by each of the other
components throughout the rest of the profile. Before a workload runs, all parameter references in a workload profile will be
replaced with the concrete values defined in the profile parameters at the top. Additionally, any parameters defined at the top
of a workload profile can be overridden on the command line. This feature allows for flexibility in running workloads for different
scenarios while not reducing the cohesion and validity of the goals that originally informed the design of the workload profile (this
latter point is why not all parameters are allowed be overridden).</p>
<pre><code class="language-bash"># An example of overriding the profile parameters so to use a smaller DiskSpd test file footprint. This might
# for example be a scenario where the local/temp disk on an Azure virtual machine should be tested. These disks
# are often very small and so the default 496G file size would be way to big.
#
# In the example JSON below, you will also see placeholders in the text of some of the step-specific parameters. These
# placeholders will match the names of the parameters at the top and will be replaced with a value before executing
# the step (e.g. [diskfillsize]).
VirtualClient.exe --profile=PERF-IO-DISKSPD.json --timeout=1440 --parameters:DiskFillSize=30G,,,FileSize=30G
</code></pre>
</li>
<li>
<p><strong>Actions</strong><br>
<!-- -->This section contains the workload execution workflow. Each of the steps in the &#x27;Actions&#x27; section will be executed in sequential order. This section
allows a given workload (or more than 1) to be executed on the system in a wide range of ways to cover system performance and reliability
requirements thoroughly and with depth. Workloads and tests are often part of the actions as they are intended to utilize the system
and its resources in a measurable way. The term &#x27;Executor&#x27; will be used often with components in the &#x27;Actions&#x27; section.</p>
</li>
<li>
<p><strong>Dependencies</strong><br>
<!-- -->This section contains steps for downloading and installing dependencies and for configuring the system to meet preliminary requirements for running
a specific workload. In the example below, there are 2 dependencies that must be accounted for before the workload is executed. All unformatted disks
on the system should be initialized and formatted. Additionally the package containing the workload binaries/executables itself should be downloaded
to the system from an Azure storage account blob store. Other examples of dependencies that are required include different Linux packages
required, libraries/frameworks (e.g. PowerShell 7.0), scripts and configuring the system itself.</p>
</li>
</ul>
<pre><code class="language-json">{
    &quot;Description&quot;: &quot;DiskSpd I/O Stress Performance Workload&quot;,
    &quot;Parameters&quot;: {
        &quot;DiskFillSize&quot;: &quot;500GB&quot;,
        &quot;FileSize&quot;: &quot;496G&quot;,
        &quot;Tests&quot;: null
    },
    &quot;Actions&quot;: [
      {
            &quot;Type&quot;: &quot;DiskSpdExecutor&quot;,
            &quot;Parameters&quot;: {
                &quot;Scenario&quot;: &quot;DiskFill&quot;,
                &quot;PackageName&quot;: &quot;diskspd&quot;,
                &quot;CommandLine&quot;: &quot;-c[diskfillsize] -b256K -si4K -t1 -o64 -w100 -Suw -W15 -D -L&quot;,
                &quot;TestName&quot;: &quot;disk_fill&quot;,
                &quot;FileName&quot;: &quot;diskspd-test.dat&quot;,
                &quot;DiskFill&quot;: true,
                &quot;DiskFillSize&quot;: &quot;$.Parameters.DiskFillSize&quot;,
                &quot;Tags&quot;: &quot;IO,DiskSpd,randwrite&quot;,
                &quot;ProcessModel&quot;: &quot;SingleProcessPerDisk&quot;,
                &quot;DeleteTestFilesOnFinish&quot;: false,
                &quot;Tests&quot;: &quot;$.Parameters.Tests&quot;
            }
        }
    ],
    &quot;Dependencies&quot;: [
        {
            &quot;Type&quot;: &quot;FormatDisks&quot;
        },
        {
            &quot;Type&quot;: &quot;DependencyPackageInstallation&quot;,
            &quot;Parameters&quot;: {
                &quot;BlobContainer&quot;: &quot;packages&quot;,
                &quot;BlobName&quot;: &quot;diskspd.1.2.0.zip&quot;,
                &quot;PackageName&quot;: &quot;diskspd&quot;,
                &quot;Extract&quot;: true
            }
        }
    ]
}
</code></pre>
<h3 id="monitoring-profiles">Monitoring Profiles</h3>
<p>Monitoring profiles define a set of one or more different background system monitors to run during the execution of the application. For example, a common monitoring scenario
is the need to capture performance counters from the system. Monitoring profiles are often used in conjunction with workload profiles to capture performance
and reliability information while workloads are executing in-parallel. The Virtual Client runs a default monitoring profile (MONITORS-DEFAULT.json) when a specific monitoring
profile is not provided. However, a different monitoring profile can be supplied on the command line if desired (extensibility).</p>
<ul>
<li><a href="/VirtualClient/docs/overview/">Monitors and Profiles Supported</a></li>
<li><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Main/profiles/MONITORS-DEFAULT.json&amp;version=GBmaster">Example Profile</a></li>
<li><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Main/profiles">Profiles Supported</a></li>
</ul>
<p>Using the example below as a reference, there are a 3 different fundamental sections inside a workload profile:</p>
<ul>
<li>
<p><strong>Parameters</strong><br>
<!-- -->Parameters in monitoring profiles serve the same purpose as they do in workload profiles. See the &#x27;Workload Profiles&#x27; section above
for details.</p>
<pre><code class="language-bash"># An example of overriding the profile parameters to capture
#
# In the example JSON below, you will also see placeholders in the text of some of the step-specific parameters. These
# placeholders will match the names of the parameters at the top and will be replaced with a value before executing
# the step (e.g. [diskfillsize]).
VirtualClient.exe --profile=MONITORS-DEFAULT.json --timeout=1440 --parameters:CounterMonitorFrequency=00:05:00,,,CounterMonitorWarmupPeriod=00:00:30
</code></pre>
</li>
<li>
<p><strong>Monitors</strong><br>
<!-- -->This section contains one or more background monitors to run on the system. These are often intended to be ran in the background while the
workloads defined in a workload profile are running. Each of the steps in the &#x27;Monitors&#x27; section will be executed on a background thread to run
concurrently and independently of each other. The monitors will typically run independently from workloads that are running on the system as well.</p>
</li>
<li>
<p><strong>Dependencies</strong><br>
<!-- -->Dependencies in monitoring profiles serve the same purpose as they do in workload profiles. See the &#x27;Workload Profiles&#x27; section above
for details.</p>
</li>
</ul>
<pre><code class="language-json">{
    &quot;Description&quot;: &quot;Default Monitors&quot;,
    &quot;Parameters&quot;: {
        &quot;CounterMonitorFrequency&quot;: &quot;00:10:00&quot;,
        &quot;CounterMonitorWarmupPeriod&quot;: &quot;00:05:00&quot;
    }
    &quot;Dependencies&quot;: [
        {
          &quot;Type&quot;: &quot;AptPackageInstallation&quot;,
          &quot;Parameters&quot;: {
            &quot;Packages&quot;: &quot;atop&quot;,
            &quot;AllowUpgrades&quot;: true
          }
        }
    ],
    &quot;Monitors&quot;: [
        {
            &quot;Type&quot;: &quot;PerfCounterMonitor&quot;,
            &quot;Parameters&quot;: {
                &quot;Scenario&quot;: &quot;PerformanceCounterMonitoring&quot;,
                &quot;MonitorFrequency&quot;: &quot;$.Parameters.CounterMonitorFrequency&quot;,
                &quot;MonitorWarmupPeriod&quot;: &quot;$.Parameters.CounterMonitorWarmupPeriod&quot;
            }
        }
    ]
}
</code></pre>
<h3 id="workload-dependency-packages">Workload Dependency Packages</h3>
<p>The section above talked a bit about defining dependencies in Virtual Client workload and monitoring profiles. The Virtual Client platform has a model defined for how dependencies should
be packaged. Virtual Client workload and dependency packages follow the strict schema for the folder structure of the packages that allows for putting binaries, scripts and
other files in the package separated by their target runtime OS and architecture platforms (e.g. win-x64, win-arm64, linux-x64, linux-arm64). Workload and dependency
packages are typically stored in an Azure storage account blob store. However, Virtual Client also supports the ability to include the packages alongside the runtime platform
and they will be incorporated at runtime without need of download.</p>
<p>In addition to workload and dependency packages stored in a Storage Account location, there are some packages that are packaged directly with the Virtual Client application itself.
The are called &quot;built-in packages&quot;. There is no specific rhyme or reason to what is determined to qualify as a built-in package; however, they are as a general rule dependencies
that are needed by more than 1 workload and often operating-system specific libraries/toolsets/binaries. Technically, any of the workload packages and dependencies could be
bundled with the Virtual Client itself removing the requirement at runtime of downloading any packages. This is not done by default because it would cause the size of
the Virtual Client package to be very large. This is an issue for deployment simplicity and reliability in cloud environments. With that said, the Virtual Client
Official build pipeline can support producing different packages/bundles for the Virtual Client that contain more workloads built-in.</p>
<h3 id="multi-instance-api-support">Multi-Instance API Support</h3>
<p>Certain workload scenarios require multiple systems to operate (e.g. client/server networking workloads and high-performance compute workloads). These workloads have a requirement to communicate
with each other to be able to synchronize client-side executions with server-side expectations. The Virtual Client has a self-hosted REST API that is used
for this purpose. This REST API enables simple HTTP communications between 2 or more different instances of the Virtual Client. The REST API provides the following
support:</p>
<ul>
<li>
<p><a href="/VirtualClient/docs/guides/0020-client-server">Client/Server Support</a></p>
</li>
<li>
<p><strong>State Management</strong><br>
<!-- -->The API enables both the client and the server instances of the application to preserve state on the local system. Additionally, state objects/requests can be
passed from the client to the server (or vice-versa) to be saved on the remote endpoint system. State is used primarily by workload executors to synchronize handshakes and
requirements between the client and the server. For example, the server workload must be confirmed online and running in the NTttcp network throughput workload
before the client can start. The client will perform a set of synchronization steps to ensure this is the case.</p>
</li>
<li>
<p><strong>Heartbeats</strong><br>
<!-- -->The API enables one instance of the Virtual Client to confirm another instance of the Virtual Client running on a different system is up and running. This is called
a heartbeat.</p>
</li>
<li>
<p><strong>Instructions/Eventing</strong><br>
<!-- -->The API also enables one instance of the Virtual Client to send an event request to another instance of the application. An event is typically a request for the
target endpoint instance to take an actions. For example in the NTttcp network throughput workload, the client will request that the server-side workload startup by sending it an
event request. It will then poll for a particular server-side state to determine when the server-side workload is definitively up and running.</p>
</li>
</ul>
<h3 id="telemetry-support">Telemetry Support</h3>
<p>One of the most important features of the Virtual Client platform is that it provides a lot of very useful telemetry. Telemetry emitted by the application follows a consistent schema
(based on Application Insights) that is designed to enable strong correlation between data related to the process/system executing the application and data related to workloads and
monitors.</p>
<p>Telemetry/data emitted by the Virtual Client application is divided into 4 different categories of data:</p>
<ul>
<li>
<p><strong>Traces/Logs/Errors</strong><br>
<!-- -->The Virtual Client is heavily instrumented with structured logging/tracing logic. This ensures that the inner workings of the application can
are easily visible to the user. This is particularly important for debugging scenarios.  Errors are a specific type of log/trace that indicate
issues that happen during the execution of Virtual Client commands. These represent situations that may be causing the Virtual Client to fail or
to work in unexpected ways.</p>
<p><strong>Workload Metrics</strong><br>
<!-- -->Workload metrics are measurements and information captured from the output of a particular workload (e.g. DiskSpd, FIO, Coremark) that represent
performance data from the system under test. Metrics also include measurements of the system performance and reliability such as performance counters.</p>
<p><strong>System Events</strong><br>
<!-- -->System events describe certain types of important information on the system beyond simple performance measurements. This might for example
include Windows registry changes or special event logs.</p>
</li>
</ul>
<h3 id="data-correlation">Data Correlation</h3>
<p>To enable correlation between data from an execution system and the Virtual Client, metadata is supplied to the Virtual Client on the command line. This is a simple way to &quot;connect-the-dots&quot;
when creating reports based on the data. This metadata will be included with every telemetry event/message that is emitted by the Virtual Client. The following shows an example of the schema
and how metadata is supplied on the command line as well as what the contents of a single telemetry event emitted would look like.</p>
<ul>
<li><a href="/VirtualClient/docs/guides/0040-telemetry">Data/Telemetry Support</a></li>
</ul>
<pre><code class="language-bash">VirtualClient.exe --profile=PERF-CPU-OPENSSL.json --timeout=1440 --experimentId=2451d02e-b22b-4e8a-9a1f-5436512dbc01 --agentId=virtualmachine01 --metadata:&quot;anyCorrelationId=identifier,,,property2=123,,,property3=true&quot;
</code></pre>
<pre><code class="language-json">{
    &quot;timestamp&quot;: &quot;2021-04-19T16:01:31.9148275Z&quot;,
    &quot;message&quot;: &quot;OpenSSLExecutor.Execute&quot;,
    &quot;severityLevel&quot;: &quot;1&quot;,
    &quot;itemType&quot;: &quot;trace&quot;,
    &quot;operation_Id&quot;: &quot;6978d01d-b28d-4f81-8a0e-6296592dad07&quot;,
    &quot;operation_ParentId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,
    &quot;appName&quot;: &quot;VirtualClient&quot;,
    &quot;appHost&quot;: &quot;virtualmachine01&quot;,
    &quot;sdkVersion&quot;: &quot;1.9.0.0&quot;,
    &quot;customDimensions&quot;: {
        &quot;agentId&quot;: &quot;virtualmachine01&quot;,
        &quot;experimentId&quot;: &quot;2451d02e-b22b-4e8a-9a1f-5436512dbc01&quot;,
        &quot;metadata&quot;: {
            &quot;anyCorrelationId&quot;: &quot;identifier&quot;,
            &quot;property2&quot;: 123,
            &quot;property3&quot;: true
        }
    }
}
</code></pre>
<h3 id="file-upload-support">File Upload Support</h3>
<p>In addition to having support for structured telemetry, the Virtual Client platform supports the ability to upload files/content to an Azure storage account
blob store. This is a need often enough with certain types of background monitors that produce very large results files too large to send through traditional
telemetry pipelines. Any component in the Virtual Client can be developed to upload files/content to a target blob store. Then the user of the application simply
passes in a connection string or SAS URI to the target &quot;content&quot; store on the command line.</p>
<ul>
<li><a href="/VirtualClient/docs/guides/0600-integration-blob-storage">Blob Store Support</a></li>
</ul>
<pre><code class="language-bash">VirtualClient.exe --profile=PERF-CPU-OPENSSL.json --timeout=1440 --contentStore={ConnectionString or SASTokenUri}
</code></pre>
<h2 id="application-development-concepts">Application Development Concepts</h2>
<p>The following sections cover some of the important application development concepts for contributing to the Virtual Client platform. Given the above concepts covered,
the next sections dive a bit more into the depths of the application (coding concepts).</p>
<h3 id="implementation-concepts">Implementation Concepts</h3>
<p>The following concepts and terminology is used to describe the various coded components that exist in Virtual Client codebase.</p>
<ul>
<li>
<p><strong>Workload Executors</strong><br>
<!-- -->A workload executor is a class/implementation that is responsible for managing initialization requirements and the execution of a given workload. Workloads can
be vastly different than each other with regards to execution requirements (e.g. which OS they can operate on, command line parameters, length of run etc...).
The workload executor foundation in Virtual Client ensures that these details are all encapsulated into one or more executors specific to
that workload. Furthermore, workload executors can be implemented to support parameterization for a wide range of different ways to run a
given workload. Workload profiles in the Virtual Client platform will have one or more workload executors defined in the &#x27;Actions&#x27; section.</p>
</li>
<li>
<p><strong>Background Monitors</strong><br>
<!-- -->A background monitor is a class/implementation that is responsible for gathering information from the system on a background thread during the lifetime of the
Virtual Client application runtime (e.g. performance counters). Monitors are implemented to start a long-running background task but will return immediately so as
to avoid blocking the main thread.</p>
</li>
<li>
<p><strong>Dependency Installers/Handlers</strong><br>
<!-- -->A dependency handler is a class/implementation that is responsible for downloading, installing and setting up dependencies on the system as preliminary requirements
before any workloads or monitors are executed. If any one of the dependencies fail to perform their task, the Virtual Client application will exit returning a code that
will indicate what actually failed.</p>
</li>
<li>
<p><strong>Components</strong><br>
<!-- -->All of the above noted types of classes/implementations in the Virtual Client codebase are collectively called &quot;components&quot;. This is a generic
term directly related to the base/fundamental class in the Virtual Client, the  <a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Contracts/VirtualClientComponent.cs">VirtualClientComponent</a>.
All workload executors, background monitors and dependency handlers in the Virtual Client codebase derive from this class.</p>
</li>
</ul>
<h3 id="telemetrylogging-concepts">Telemetry/Logging Concepts</h3>
<p>To ensure consistency, a set of common extension methods are used to capture all telemetry from the operations of the application or the execution of workloads and monitors.</p>
<ul>
<li><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Contracts/VirtualClientLoggingExtensions.cs">Logging Extensions</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/VirtualClient/edit/main/website/docs/overview/0020-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/VirtualClient/docs/overview/features/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Platform Features</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/VirtualClient/docs/overview/roadmap/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Platform Roadmap</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#application-concepts" class="table-of-contents__link toc-highlight">Application Concepts</a><ul><li><a href="#workloadtest-profiles" class="table-of-contents__link toc-highlight">Workload/Test Profiles</a></li><li><a href="#monitoring-profiles" class="table-of-contents__link toc-highlight">Monitoring Profiles</a></li><li><a href="#workload-dependency-packages" class="table-of-contents__link toc-highlight">Workload Dependency Packages</a></li><li><a href="#multi-instance-api-support" class="table-of-contents__link toc-highlight">Multi-Instance API Support</a></li><li><a href="#telemetry-support" class="table-of-contents__link toc-highlight">Telemetry Support</a></li><li><a href="#data-correlation" class="table-of-contents__link toc-highlight">Data Correlation</a></li><li><a href="#file-upload-support" class="table-of-contents__link toc-highlight">File Upload Support</a></li></ul></li><li><a href="#application-development-concepts" class="table-of-contents__link toc-highlight">Application Development Concepts</a><ul><li><a href="#implementation-concepts" class="table-of-contents__link toc-highlight">Implementation Concepts</a></li><li><a href="#telemetrylogging-concepts" class="table-of-contents__link toc-highlight">Telemetry/Logging Concepts</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/VirtualClient/docs/overview/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/microsoft/VirtualClient/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/VirtualClient/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/microsoft/VirtualClient" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://microsoft.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/VirtualClient/img/microsoft-logo-white-text.svg" alt="MSFT Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/VirtualClient/img/microsoft-logo-white-text.svg" alt="MSFT Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2024 Microsoft.</div></div></div></footer></div>
</body>
</html>