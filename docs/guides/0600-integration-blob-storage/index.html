<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/0600-integration-blob-storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Azure Storage Account Integration | Virtual Client Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/VirtualClient/docs/guides/0600-integration-blob-storage/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="performance, benchmarking, automation, framework, microsoft"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Azure Storage Account Integration | Virtual Client Platform"><meta data-rh="true" name="description" content="Virtual Client supports a few different types of Azure Blob stores that can be used as part of a workload profile execution. This documentation"><meta data-rh="true" property="og:description" content="Virtual Client supports a few different types of Azure Blob stores that can be used as part of a workload profile execution. This documentation"><link data-rh="true" rel="icon" href="/VirtualClient/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/VirtualClient/docs/guides/0600-integration-blob-storage/"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/VirtualClient/docs/guides/0600-integration-blob-storage/" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/VirtualClient/docs/guides/0600-integration-blob-storage/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0I7D8A07MA-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/VirtualClient/blog/rss.xml" title="Virtual Client Platform RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/VirtualClient/blog/atom.xml" title="Virtual Client Platform Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Virtual Client Platform" href="/VirtualClient/opensearch.xml"><link rel="stylesheet" href="/VirtualClient/assets/css/styles.9af2558c.css">
<script src="/VirtualClient/assets/js/runtime~main.e42e4ff5.js" defer="defer"></script>
<script src="/VirtualClient/assets/js/main.88e09cd5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like VirtualClient, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/VirtualClient">GitHub</a> ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/VirtualClient/"><div class="navbar__logo"><img src="/VirtualClient/img/vc-logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/VirtualClient/img/vc-logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Virtual Client</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/VirtualClient/docs/overview/">Documentation</a><a class="navbar__item navbar__link" href="/VirtualClient/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/VirtualClient" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/overview/">Overview</a><button aria-label="Expand sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/VirtualClient/docs/category/guides/">Guides</a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/getting-started/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0002-getting-started-client-server/">Getting Started (Client/Server)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0003-getting-started-docker/">Getting Started (Docker)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0010-command-line/">Command Line Options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0011-profiles/">Profiles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0020-client-server/">Client/Server Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0030-commercial-workloads/">Run Commercial Workloads: Bring Your Own Package</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0040-telemetry/">Data/Telemetry Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0200-usage-examples/">Usage: Command Line Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0220-usage-testing-disks/">Usage: Testing Disks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0221-usage-extensions/">Usage: Using Custom Extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/VirtualClient/docs/guides/0600-integration-blob-storage/">Azure Storage Account Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/VirtualClient/docs/guides/0610-integration-event-hub/">Azure Event Hub Integration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/workloads/">Workloads</a><button aria-label="Expand sidebar category &#x27;Workloads&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/monitors/">Monitors</a><button aria-label="Expand sidebar category &#x27;Monitors&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/dependencies/">Dependencies</a><button aria-label="Expand sidebar category &#x27;Dependencies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/VirtualClient/docs/category/developing/">Developing</a><button aria-label="Expand sidebar category &#x27;Developing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/VirtualClient/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/VirtualClient/docs/category/guides/"><span itemprop="name">Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Azure Storage Account Integration</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="azure-storage-account-integration">Azure Storage Account Integration</h1>
<p>Virtual Client supports a few different types of Azure Blob stores that can be used as part of a workload profile execution. This documentation
covers how to supply those blob stores to the Virtual Client on the command line as well as how to use them in Virtual Client codebase.</p>
<h2 id="supported-blob-stores">Supported Blob Stores</h2>
<p>The following stores are supported by the Virtual Client. The stores must be Azure Storage Account blob stores.</p>
<ul>
<li>
<p><strong>Packages Store</strong><br>
<!-- -->The packages blob store contains workload and dependency packages that must be downloaded to a system during the execution of a
workload profile. These are typically NuGet/zip files that contain binaries, scripts, etc... that are required by the scenario profile.</p>
<p>The packages store can be supplied to the Virtual Client on the command line using the &#x27;--packageStore&#x27; parameter and supplying the
full connection string to the Azure storage account blob resource.</p>
<pre><code class="language-bash"># The blob container does not require authentication (i.e. blob-anonymous read access)
VirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --packageStore=&quot;https://any.blob.core.windows.net&quot;

# The blob continer requires authentication (e.g. a SAS token)
VirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --packageStore=&quot;https://any.blob.core.windows.net/packages?sp=r&amp;st=2022-05-09T18:31:45Z&amp;se=2030-05-10T02:31:45Z&amp;spr=https&amp;sv=2020-08-04&amp;sr=c&amp;sig=...&quot;
</code></pre>
<p><img alt="packages store" src="/VirtualClient/assets/images/blob-storage-support-1-d9b6235d6d18b00cc7b4386411085260.png" width="1179" height="479"></p>
</li>
<li>
<p><strong>Content Store</strong><br>
<!-- -->The content blob store is used for uploading files and content captured by workloads or monitors that run as part of Virtual Client workload
operations. For example, a monitor might be implemented to upload certain types of logs, bin files or cab files to the specified content blob
store.</p>
<pre><code># The blob container does not require authentication (i.e. blob-anonymous read access)
VirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --contentStore=&quot;https://any.blob.core.windows.net&quot;

# The blob continer requires authentication (e.g. a SAS token)
VirtualClient.exe --profile=PERF-NETWORK.json --timeout=1440 --contentStore=&quot;https://any.blob.core.windows.net/packages?sp=r&amp;st=2022-05-09T18:31:45Z&amp;se=2030-05-10T02:31:45Z&amp;spr=https&amp;sv=2020-08-04&amp;sr=c&amp;sig=...&quot;
</code></pre>
<p><img alt="monitoring content" src="/VirtualClient/assets/images/blob-storage-support-2-47336ce50b38a5094f58f1be47565aeb.png" width="1350" height="530"></p>
</li>
</ul>
<h2 id="blob-store-authentication">Blob Store Authentication</h2>
<p>Virtual Client supports the following authentication options for all blob stores:</p>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview">Shared Access Signatures (SAS) Overview</a><br>
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-account-sas?redirectedfrom=MSDN">Account Shared Access Signatures</a></p>
<ul>
<li>
<p><strong>Azure Entra Id + Certificate using thumbprint</strong>
VC uses certificate to authenticate with an Azure Entra ID (AAD) application, which has read access to the package store.
This method uses certificate thumbprint to search for the certificate. Required parameters are:</p>
<ul>
<li>CertificateThumbprint</li>
<li>ClientId</li>
<li>TenantId</li>
<li>EndpointUrl</li>
</ul>
<p><code>--packages=CertificateThumbprint=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;ClientId=BBBBBBBB-BBBB-BBBB-BBBB-BBBBBBBBBBBB;TenantId=CCCCCCCC-CCCC-CCCC-CCCC-CCCCCCCCCCCC;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages</code></p>
</li>
<li>
<p><strong>Azure Entra Id + Certificate using issuer + subject</strong>
VC uses certificate to authenticate with an Azure Entra ID (AAD) application, which has read access to the package store.
This method uses certificate issuer + subject to search for the certificate. This has the benefit of supporting frequent cert rotation with no argument changes. The issuer can be a substring of the exact issuer appearing in the certificate. The search only looks for contains.
Required parameters are:</p>
<ul>
<li>CertificateIssuer</li>
<li>CertificateSubject</li>
<li>ClientId</li>
<li>TenantId</li>
<li>EndpointUrl</li>
</ul>
<p><code>--packages=CertificateIssuer=XXX CA Authority;CertificateSubject=aaa.bbb.com;ClientId=BBBBBBBB-BBBB-BBBB-BBBB-BBBBBBBBBBBB;TenantId=CCCCCCCC-CCCC-CCCC-CCCC-CCCCCCCCCCCC;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages</code></p>
</li>
<li>
<p><strong>Azure Managed Identity</strong>
This method uses Azure managed identity to authenticate. An id is required to support cases where a machine have multiple identities.</p>
<p><code>--packages=ManagedIdentityId=AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA;EndpointUrl=https://yourblobstore.blob.core.windows.net/packages</code></p>
</li>
<li>
<p><strong>Blob Service SAS URI</strong><br>
<!-- -->This is a SAS URI to the Blob service in the storage account. This provides exactly the same types of privileges as the Blob service-level connection string noted above.</p>
<p><code>(e.g. https://anystorageaccount.blob.core.windows.net/?sv=2020-08-04&amp;ss=b&amp;srt=c&amp;sp=rwlacx&amp;se=2021-11-23T14:30:18Z&amp;st=2021-11-23T02:19:18Z&amp;spr=https&amp;sig=jcql6El...)</code></p>
</li>
<li>
<p><strong>Blob Container SAS URI</strong><br>
<!-- -->This is a SAS URI to a single blob container within the storage account. This is the most restrictive way of providing privileges but is also the most secure because it
provides the least amount of access to the application. This is a good fit for scenarios where all content (e.g. across all monitors) is uploaded to a single container
within the blob store.</p>
<p><code>(e.g. https://anystorageaccount.blob.core.windows.net/packages?sp=r&amp;st=2021-11-23T18:22:49Z&amp;se=2021-11-24T02:22:49Z&amp;spr=https&amp;sv=2020-08-04&amp;sr=c&amp;sig=ndyPRH...)</code></p>
</li>
<li>
<p><strong>Storage Account Connection String (Deprecated)</strong><br>
<!-- -->The primary or secondary connection string to the Azure storage account. This provides full access privileges to the entire
storage account but the least amount of security. This is generally recommended only for testing scenarios. The use of a
SAS URI or connection string is preferred because it enables finer grained control of the exact resources within the storage
account that the application should be able to access.</p>
<p><code>(e.g. DefaultEndpointsProtocol=https;AccountName=anystorageaccount;AccountKey=w7Q+BxLw...;EndpointSuffix=core.windows.net)</code></p>
</li>
<li>
<p><strong>Blob Service Connection String (Deprecated)</strong><br>
<!-- -->This is a connection string to the Blob service in the storage account. It allows user-defined/restricted access privileges to be defined for
all containers and blobs in the storage account. This is a good fit for scenarios where content (e.g. from different monitors) is uploaded to
different containers within the blob store and thus the application needs access to all containers.</p>
<p><code>(e.g. BlobEndpoint=https://anystorageaccount.blob.core.windows.net/;SharedAccessSignature=sv=2020-08-04&amp;ss=b&amp;srt=c&amp;sp=rwlacx&amp;se=2021-11-23T14:30:18Z&amp;st=2021-11-23T02:19:18Z&amp;spr=https&amp;sig=jcql6El...)</code></p>
</li>
</ul>
<p>Use the following recommendations when creating shared access keys in the blob store to ensure the right amount of privileges
are granted to the Virtual Client application for uploading and downloading blobs.</p>
<ul>
<li>
<p><strong>Blob Service Connection Strings or SAS URIs</strong><br>
<!-- -->Select the following options when defining shared access signatures at the Blob service level:</p>
<ul>
<li>Allowed services = Blob</li>
<li>Allowed resource types = Container, Object</li>
<li>Allowed permissions = Read, Write, Create</li>
<li>Allowed protocols = HTTPS only</li>
</ul>
<p><img src="/VirtualClient/assets/images/blob-service-sas-1-913224b9cf8a2c796f3d819b91939292.png" width="1357" height="914"></p>
</li>
<li>
<p><strong>Blob Container SAS URIs</strong><br>
<!-- -->Select the following options when defining shared access signatures at the Blob container level:</p>
<ul>
<li>Signing method = Account key</li>
<li>Permissions = Read, Write, Create</li>
<li>Allowed protocols = HTTPS only</li>
</ul>
<p><img src="/VirtualClient/assets/images/blob-container-sas-1-92090121e019eb6d574ed1e48d2ec0ea.png" width="1000" height="743"></p>
</li>
</ul>
<h3 id="blob-store-folderfile-naming-conventions">Blob Store Folder/File Naming Conventions</h3>
<p>In  order to ensure that files associated with Virtual Client executors or monitors are easy to find in the blob stores, Virtual Client supports a flexible blob path template.
At a high level, all files associated with a given experiment are contained together in the blob store.</p>
<p>The virtual path of uploaded logs in blob storage is controlled by a VirtualClient Command Line Option parameter &quot;--contentPathTemplate&quot;.</p>
<p>Example: --contentPathTemplate=&quot;any-value1/&lt;standardProperty1&gt;any-value2&lt;standardProperty2&gt;/&lt;standardProperty3&gt;/any-value3/&lt;standardProperty4&gt;&quot;.</p>
<p>In above example, the virtual blob folder structure will have sub-folders corresponding to each element separated by a &#x27;/&#x27; in the
ContentPathTemplate. The inlined values that are enclosed within brackets &quot;<!-- -->&quot;, like &quot;standaradProperty1&quot; and &quot;standaradProperty2&quot;,
needs to be one among the 5 defined standard properties of Virtual Client (ExperimentId, AgentId, ToolName, Role, Scenario).</p>
<p>The first component of ContentPathTemplate (any-value1 in above example) will be taken up as the name of Blob storage Container where all files will be uploaded.
The next component (&lt;standardProperty1&gt; in above example) will be the root folder within the container and so on for the complete virtual folder structure within the blob storage.</p>
<p>The default value of &quot;ContentPathTemplate&quot; is <code>{experimentId}/{agentId}/{toolName}/{role}/{scenario}</code>. In the default template, each element
is a standard property identified by Virtual Client.</p>
<ul>
<li>
<p><strong>Experiment ID</strong><br>
<!-- -->The ID of the experiment is used to ensure all files associated with any executors or monitors are in the same virtual folder within the blob store.
Furthermore because an experiment ID is a global identifier, it is easier for the user or automation to find files associated with a given experiment
(e.g. for debugging/triage).</p>
</li>
<li>
<p><strong>Agent ID</strong><br>
<!-- -->The ID of the Virtual Client instance running (i.e. the agent) is also included. This ensures that files captured from a specific VM or node etc... are easy
to distinguish from each other.</p>
</li>
<li>
<p><strong>Tool Name</strong><br>
<!-- -->This is the name of the executor or monitor that created the files (directly or indirectly).</p>
</li>
<li>
<p><strong>Role</strong><br>
<!-- -->This is relevant for workloads that use multiple systems, and each system has an assigned role like Client or Server.</p>
</li>
<li>
<p><strong>ScenarioName</strong><br>
<!-- -->It is an indicator of the scenario being tested by the workload. It is defined for each action/monitor in an execution profile.</p>
</li>
</ul>
<p>All files will be uploaded in a virtual folder structure as defined by the ContentPathTemplate. For each file uploaded, a timestamp will be
prefixed to it so as to provide unique names.</p>
<ul>
<li>
<p><strong>File Name</strong><br>
<!-- -->This is the name of the file as it should be reflected in the blob store. A timestamp (round-trip date/time format) will be added to the beginning of the file name
(e.g. 2023-08-17t0637583781z-monitor.log). The addition of the timestamp ensures that the files within a given virtual folder in the blob store will all
have unique names in order to avoid collisions. Round-trip date/time formats in addition to being a valid timestamp are naturally sortable in UX experiences
such as a web browser.</p>
</li>
<li>
<p><strong>Round-Trip Formatted Timestamp</strong><br>
<!-- -->As noted above, a round-trip formatted timestamp will be added to each file name to ensure uniqueness.</p>
</li>
</ul>
<p>Given the pieces of information noted above, the format for virtual paths and file names will look like:</p>
<pre><code class="language-csharp">// ContentPathTemplate and Parameters as defined in Virtual Client CommandLine:
// -----------------------------------------------
VirtualClient.exe --profile=........ --contentPathTemplate=&quot;value1/expt_{experimentId}_agent_{agentId}/{toolName}/value-2&quot; 

// Examples:
// -----------------------------------------------
// Given the Following Information:
// - Experiment ID = 24149a49-66c9-4bd1-9332-18370c7c70e1
// - Agent ID = cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01
// - ToolName - a Background Monitor = exampleMonitor
// - Files Produced = monitor.log
//
// The blob virtual folder paths/names would like the following:
value1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:32:27.1237655Z-monitor.log
value1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:34:32.6483092Z-monitor.log
value1/expt_24149a49-66c9-4bd1-9332-18370c7c70e1_expt_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/value-2/2022-03-07T01:36:30.2645013Z-monitor.log

// Structure Within the Blob Store:
// -----------------------------------------------
// (container) value1 
//   -&gt; (virtual folder) /expt_24149a49-66c9-4bd1-9332-18370c7c70e1_agent_cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01
//     -&gt; (virtual folder) /examplemonitor
//       -&gt; (virtual folder) /value-2
//         -&gt; (blob) 2022-03-07T01:32:27.1237655Z-monitor.log
//         -&gt; (blob) 2022-03-07T01:34:32.6483092Z-monitor.log
//         -&gt; (blob) 2022-03-07T01:36:30.2645013Z-monitor.log
</code></pre>
<hr>
<h3 id="integration-with-the-development-process">Integration with the Development Process</h3>
<p>This section describes how access to the supported blob stores can be integrated into the Virtual Client process.</p>
<h5 id="how-blob-stores-are-integrated-into-dependencies">How Blob Stores are Integrated into Dependencies</h5>
<p>When the Virtual Client reads the blob stores (i.e. connection strings) from the command line, it will place a set of
BlobStore objects into the dependencies collection that is passed into the constructors of ALL profile actions, dependencies
and monitors.</p>
<pre><code class="language-csharp">// In the CommandBase class in the Main project
List&lt;BlobStore&gt; blobStores = new List&lt;BlobStore&gt;();
if (this.ContentBlobStore != null)
{
    blobStores.Add(this.ContentBlobStore);
}

if (this.PackagesBlobStore != null)
{
    blobStores.Add(this.PackagesBlobStore);
}

IServiceCollection dependencies = new ServiceCollection();
...
dependencies.AddSingleton&lt;IEnumerable&lt;BlobStore&gt;&gt;(blobStores);
</code></pre>
<p>Each of the BlobStore instances describes a single blob store that can be then used within any of the components described
in the profile. To use upload or download blobs from one of the stores, create a BlobManager instance. The blob manager has
simple download and upload methods available.</p>
<p><a href="https://github.com/microsoft/VirtualClient/blob/main/src/VirtualClient/VirtualClient.Monitors/ExampleMonitorWithBlobUploadIntegration.cs">Example Implementation/Usage</a></p>
<pre><code class="language-csharp">// Using the example implementation noted above:
//
// Get the blob store reference and create a BlobManager to upload blobs to the store.
if (this.TryGetContentStore(out BlobStore contentStore))
{
    DateTime snapshotTime = DateTime.UtcNow;
    IBlobManager blobManager = new BlobManager(contentStore.ConnectionString);

    // For this example, assume there is a file that contains the output of some monitoring
    // toolset. We want to upload this file to the content blob store.
    using (FileStream uploadStream = new FileStream(resultsFilePath, FileMode.Open, FileAccess.Read, FileShare.Read))
    {
        BlobDescriptor resultsBlob = new BlobDescriptor
        {
            // For this scenario, we have a folder structure and naming convention for each of the blobs
            // that is specific to the monitor but that also allows for consecutive blobs to be uploaded without
            // overwriting previously uploaded blobs.
            //
            // Example:
            // Given an experiment ID = 24149a49-66c9-4bd1-9332-18370c7c70e1 and an Agent ID = cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01:
            //
            // Format = 24149a49-66c9-4bd1-9332-18370c7c70e1/cluster01,cc296787-aee6-4ce4-b814-180627508d12,anyvm-01/examplemonitor/2022-03-07T01:32:27.1237655Z-monitor.log
            BlobName = BlobDescriptor.ToPath(this.ExperimentId, this.AgentId, &quot;examplemonitor&quot;, &quot;monitor.log&quot;),
            ContainerName = &quot;monitors&quot;,
            ContentEncoding = Encoding.UTF8,
            ContentType = &quot;text/plain&quot;
        };

        await blobManager.UploadBlobAsync(resultsBlob, uploadStream, cancellationToken)
            .ConfigureAwait(false);
    }
}
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/VirtualClient/edit/main/website/docs/guides/0600-integration-blob-storage.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/VirtualClient/docs/guides/0221-usage-extensions/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Usage: Using Custom Extensions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/VirtualClient/docs/guides/0610-integration-event-hub/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Azure Event Hub Integration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#supported-blob-stores" class="table-of-contents__link toc-highlight">Supported Blob Stores</a></li><li><a href="#blob-store-authentication" class="table-of-contents__link toc-highlight">Blob Store Authentication</a><ul><li><a href="#blob-store-folderfile-naming-conventions" class="table-of-contents__link toc-highlight">Blob Store Folder/File Naming Conventions</a></li><li><a href="#integration-with-the-development-process" class="table-of-contents__link toc-highlight">Integration with the Development Process</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/VirtualClient/docs/overview/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/microsoft/VirtualClient/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/VirtualClient/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/microsoft/VirtualClient" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://microsoft.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/VirtualClient/img/microsoft-logo-white-text.svg" alt="MSFT Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/VirtualClient/img/microsoft-logo-white-text.svg" alt="MSFT Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2024 Microsoft.</div></div></div></footer></div>
</body>
</html>